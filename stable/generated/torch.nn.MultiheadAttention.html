<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
 <!--<![endif]-->
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   MultiheadAttention — PyTorch 1.12 documentation
  </title>
  <!-- <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> -->
  <!-- Google Analytics -->
  <!-- End Google Analytics -->
  <!-- Preload the theme fonts -->
  <!-- Preload the katex fonts -->
 </head>
 <body class="pytorch-body">
  <div class="pytorch-container">
   <section class="pytorch-content-wrap" data-toggle="wy-nav-shift" id="pytorch-content-wrap">
    <div class="pytorch-content-left">
     <div class="rst-content">
      <div class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
       <article class="pytorch-article" id="pytorch-article" itemprop="articleBody">
        <div class="section" id="multiheadattention">
         <h1>
          MultiheadAttention
          <a class="headerlink" href="#multiheadattention" title="Permalink to this headline">
           ¶
          </a>
         </h1>
         <dl class="py class">
          <dt id="torch.nn.MultiheadAttention">
           <em class="property">
            <span class="pre">
             class
            </span>
           </em>
           <code class="sig-prename descclassname">
            <span class="pre">
             torch.nn.
            </span>
           </code>
           <code class="sig-name descname">
            <span class="pre">
             MultiheadAttention
            </span>
           </code>
           <span class="sig-paren">
            (
           </span>
           <em class="sig-param">
            <span class="n">
             <span class="pre">
              embed_dim
             </span>
            </span>
           </em>
           ,
           <em class="sig-param">
            <span class="n">
             <span class="pre">
              num_heads
             </span>
            </span>
           </em>
           ,
           <em class="sig-param">
            <span class="n">
             <span class="pre">
              dropout
             </span>
            </span>
            <span class="o">
             <span class="pre">
              =
             </span>
            </span>
            <span class="default_value">
             <span class="pre">
              0.0
             </span>
            </span>
           </em>
           ,
           <em class="sig-param">
            <span class="n">
             <span class="pre">
              bias
             </span>
            </span>
            <span class="o">
             <span class="pre">
              =
             </span>
            </span>
            <span class="default_value">
             <span class="pre">
              True
             </span>
            </span>
           </em>
           ,
           <em class="sig-param">
            <span class="n">
             <span class="pre">
              add_bias_kv
             </span>
            </span>
            <span class="o">
             <span class="pre">
              =
             </span>
            </span>
            <span class="default_value">
             <span class="pre">
              False
             </span>
            </span>
           </em>
           ,
           <em class="sig-param">
            <span class="n">
             <span class="pre">
              add_zero_attn
             </span>
            </span>
            <span class="o">
             <span class="pre">
              =
             </span>
            </span>
            <span class="default_value">
             <span class="pre">
              False
             </span>
            </span>
           </em>
           ,
           <em class="sig-param">
            <span class="n">
             <span class="pre">
              kdim
             </span>
            </span>
            <span class="o">
             <span class="pre">
              =
             </span>
            </span>
            <span class="default_value">
             <span class="pre">
              None
             </span>
            </span>
           </em>
           ,
           <em class="sig-param">
            <span class="n">
             <span class="pre">
              vdim
             </span>
            </span>
            <span class="o">
             <span class="pre">
              =
             </span>
            </span>
            <span class="default_value">
             <span class="pre">
              None
             </span>
            </span>
           </em>
           ,
           <em class="sig-param">
            <span class="n">
             <span class="pre">
              batch_first
             </span>
            </span>
            <span class="o">
             <span class="pre">
              =
             </span>
            </span>
            <span class="default_value">
             <span class="pre">
              False
             </span>
            </span>
           </em>
           ,
           <em class="sig-param">
            <span class="n">
             <span class="pre">
              device
             </span>
            </span>
            <span class="o">
             <span class="pre">
              =
             </span>
            </span>
            <span class="default_value">
             <span class="pre">
              None
             </span>
            </span>
           </em>
           ,
           <em class="sig-param">
            <span class="n">
             <span class="pre">
              dtype
             </span>
            </span>
            <span class="o">
             <span class="pre">
              =
             </span>
            </span>
            <span class="default_value">
             <span class="pre">
              None
             </span>
            </span>
           </em>
           <span class="sig-paren">
            )
           </span>
           <a class="reference internal" href="../_modules/torch/nn/modules/activation.html#MultiheadAttention">
            <span class="viewcode-link">
             <span class="pre">
              [source]
             </span>
            </span>
           </a>
           <a class="headerlink" href="#torch.nn.MultiheadAttention" title="Permalink to this definition">
            ¶
           </a>
          </dt>
          <dd>
           <p>
            Allows the model to jointly attend to information
from different representation subspaces as described in the paper:
            <a class="reference external" href="https://arxiv.org/abs/1706.03762">
             Attention Is All You Need
            </a>
            .
           </p>
           <p>
            Multi-Head Attention is defined as:
           </p>
           <div class="math">
            <span class="katex-display">
             <span class="katex">
              <span class="katex-mathml">
               <math display="block" xmlns="http://www.w3.org/1998/Math/MathML">
                <semantics>
                 <mrow>
                  <mtext>
                   MultiHead
                  </mtext>
                  <mo stretchy="false">
                   (
                  </mo>
                  <mi>
                   Q
                  </mi>
                  <mo separator="true">
                   ,
                  </mo>
                  <mi>
                   K
                  </mi>
                  <mo separator="true">
                   ,
                  </mo>
                  <mi>
                   V
                  </mi>
                  <mo stretchy="false">
                   )
                  </mo>
                  <mo>
                   =
                  </mo>
                  <mtext>
                   Concat
                  </mtext>
                  <mo stretchy="false">
                   (
                  </mo>
                  <mi>
                   h
                  </mi>
                  <mi>
                   e
                  </mi>
                  <mi>
                   a
                  </mi>
                  <msub>
                   <mi>
                    d
                   </mi>
                   <mn>
                    1
                   </mn>
                  </msub>
                  <mo separator="true">
                   ,
                  </mo>
                  <mo>
                   …
                  </mo>
                  <mo separator="true">
                   ,
                  </mo>
                  <mi>
                   h
                  </mi>
                  <mi>
                   e
                  </mi>
                  <mi>
                   a
                  </mi>
                  <msub>
                   <mi>
                    d
                   </mi>
                   <mi>
                    h
                   </mi>
                  </msub>
                  <mo stretchy="false">
                   )
                  </mo>
                  <msup>
                   <mi>
                    W
                   </mi>
                   <mi>
                    O
                   </mi>
                  </msup>
                 </mrow>
                 <annotation encoding="application/x-tex">
                  \text{MultiHead}(Q, K, V) = \text{Concat}(head_1,\dots,head_h)W^O
                 </annotation>
                </semantics>
               </math>
              </span>
              <span aria-hidden="true" class="katex-html">
               <span class="base">
                <span class="strut" style="height:1em;vertical-align:-0.25em;">
                </span>
                <span class="mord text">
                 <span class="mord">
                  MultiHead
                 </span>
                </span>
                <span class="mopen">
                 (
                </span>
                <span class="mord mathnormal">
                 Q
                </span>
                <span class="mpunct">
                 ,
                </span>
                <span class="mspace" style="margin-right:0.1667em;">
                </span>
                <span class="mord mathnormal" style="margin-right:0.07153em;">
                 K
                </span>
                <span class="mpunct">
                 ,
                </span>
                <span class="mspace" style="margin-right:0.1667em;">
                </span>
                <span class="mord mathnormal" style="margin-right:0.22222em;">
                 V
                </span>
                <span class="mclose">
                 )
                </span>
                <span class="mspace" style="margin-right:0.2778em;">
                </span>
                <span class="mrel">
                 =
                </span>
                <span class="mspace" style="margin-right:0.2778em;">
                </span>
               </span>
               <span class="base">
                <span class="strut" style="height:1.1413em;vertical-align:-0.25em;">
                </span>
                <span class="mord text">
                 <span class="mord">
                  Concat
                 </span>
                </span>
                <span class="mopen">
                 (
                </span>
                <span class="mord mathnormal">
                 h
                </span>
                <span class="mord mathnormal">
                 e
                </span>
                <span class="mord mathnormal">
                 a
                </span>
                <span class="mord">
                 <span class="mord mathnormal">
                  d
                 </span>
                 <span class="msupsub">
                  <span class="vlist-t vlist-t2">
                   <span class="vlist-r">
                    <span class="vlist" style="height:0.3011em;">
                     <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                      <span class="pstrut" style="height:2.7em;">
                      </span>
                      <span class="sizing reset-size6 size3 mtight">
                       <span class="mord mtight">
                        1
                       </span>
                      </span>
                     </span>
                    </span>
                    <span class="vlist-s">
                     ​
                    </span>
                   </span>
                   <span class="vlist-r">
                    <span class="vlist" style="height:0.15em;">
                     <span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
                <span class="mpunct">
                 ,
                </span>
                <span class="mspace" style="margin-right:0.1667em;">
                </span>
                <span class="minner">
                 …
                </span>
                <span class="mspace" style="margin-right:0.1667em;">
                </span>
                <span class="mpunct">
                 ,
                </span>
                <span class="mspace" style="margin-right:0.1667em;">
                </span>
                <span class="mord mathnormal">
                 h
                </span>
                <span class="mord mathnormal">
                 e
                </span>
                <span class="mord mathnormal">
                 a
                </span>
                <span class="mord">
                 <span class="mord mathnormal">
                  d
                 </span>
                 <span class="msupsub">
                  <span class="vlist-t vlist-t2">
                   <span class="vlist-r">
                    <span class="vlist" style="height:0.3361em;">
                     <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                      <span class="pstrut" style="height:2.7em;">
                      </span>
                      <span class="sizing reset-size6 size3 mtight">
                       <span class="mord mathnormal mtight">
                        h
                       </span>
                      </span>
                     </span>
                    </span>
                    <span class="vlist-s">
                     ​
                    </span>
                   </span>
                   <span class="vlist-r">
                    <span class="vlist" style="height:0.15em;">
                     <span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
                <span class="mclose">
                 )
                </span>
                <span class="mord">
                 <span class="mord mathnormal" style="margin-right:0.13889em;">
                  W
                 </span>
                 <span class="msupsub">
                  <span class="vlist-t">
                   <span class="vlist-r">
                    <span class="vlist" style="height:0.8913em;">
                     <span style="top:-3.113em;margin-right:0.05em;">
                      <span class="pstrut" style="height:2.7em;">
                      </span>
                      <span class="sizing reset-size6 size3 mtight">
                       <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                        O
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
               </span>
              </span>
             </span>
            </span>
           </div>
           <p>
            where
            <span class="math">
             <span class="katex">
              <span class="katex-mathml">
               <math xmlns="http://www.w3.org/1998/Math/MathML">
                <semantics>
                 <mrow>
                  <mi>
                   h
                  </mi>
                  <mi>
                   e
                  </mi>
                  <mi>
                   a
                  </mi>
                  <msub>
                   <mi>
                    d
                   </mi>
                   <mi>
                    i
                   </mi>
                  </msub>
                  <mo>
                   =
                  </mo>
                  <mtext>
                   Attention
                  </mtext>
                  <mo stretchy="false">
                   (
                  </mo>
                  <mi>
                   Q
                  </mi>
                  <msubsup>
                   <mi>
                    W
                   </mi>
                   <mi>
                    i
                   </mi>
                   <mi>
                    Q
                   </mi>
                  </msubsup>
                  <mo separator="true">
                   ,
                  </mo>
                  <mi>
                   K
                  </mi>
                  <msubsup>
                   <mi>
                    W
                   </mi>
                   <mi>
                    i
                   </mi>
                   <mi>
                    K
                   </mi>
                  </msubsup>
                  <mo separator="true">
                   ,
                  </mo>
                  <mi>
                   V
                  </mi>
                  <msubsup>
                   <mi>
                    W
                   </mi>
                   <mi>
                    i
                   </mi>
                   <mi>
                    V
                   </mi>
                  </msubsup>
                  <mo stretchy="false">
                   )
                  </mo>
                 </mrow>
                 <annotation encoding="application/x-tex">
                  head_i = \text{Attention}(QW_i^Q, KW_i^K, VW_i^V)
                 </annotation>
                </semantics>
               </math>
              </span>
              <span aria-hidden="true" class="katex-html">
               <span class="base">
                <span class="strut" style="height:0.8444em;vertical-align:-0.15em;">
                </span>
                <span class="mord mathnormal">
                 h
                </span>
                <span class="mord mathnormal">
                 e
                </span>
                <span class="mord mathnormal">
                 a
                </span>
                <span class="mord">
                 <span class="mord mathnormal">
                  d
                 </span>
                 <span class="msupsub">
                  <span class="vlist-t vlist-t2">
                   <span class="vlist-r">
                    <span class="vlist" style="height:0.3117em;">
                     <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                      <span class="pstrut" style="height:2.7em;">
                      </span>
                      <span class="sizing reset-size6 size3 mtight">
                       <span class="mord mathnormal mtight">
                        i
                       </span>
                      </span>
                     </span>
                    </span>
                    <span class="vlist-s">
                     ​
                    </span>
                   </span>
                   <span class="vlist-r">
                    <span class="vlist" style="height:0.15em;">
                     <span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
                <span class="mspace" style="margin-right:0.2778em;">
                </span>
                <span class="mrel">
                 =
                </span>
                <span class="mspace" style="margin-right:0.2778em;">
                </span>
               </span>
               <span class="base">
                <span class="strut" style="height:1.2361em;vertical-align:-0.2769em;">
                </span>
                <span class="mord text">
                 <span class="mord">
                  Attention
                 </span>
                </span>
                <span class="mopen">
                 (
                </span>
                <span class="mord mathnormal">
                 Q
                </span>
                <span class="mord">
                 <span class="mord mathnormal" style="margin-right:0.13889em;">
                  W
                 </span>
                 <span class="msupsub">
                  <span class="vlist-t vlist-t2">
                   <span class="vlist-r">
                    <span class="vlist" style="height:0.9592em;">
                     <span style="top:-2.4231em;margin-left:-0.1389em;margin-right:0.05em;">
                      <span class="pstrut" style="height:2.7em;">
                      </span>
                      <span class="sizing reset-size6 size3 mtight">
                       <span class="mord mathnormal mtight">
                        i
                       </span>
                      </span>
                     </span>
                     <span style="top:-3.1809em;margin-right:0.05em;">
                      <span class="pstrut" style="height:2.7em;">
                      </span>
                      <span class="sizing reset-size6 size3 mtight">
                       <span class="mord mathnormal mtight">
                        Q
                       </span>
                      </span>
                     </span>
                    </span>
                    <span class="vlist-s">
                     ​
                    </span>
                   </span>
                   <span class="vlist-r">
                    <span class="vlist" style="height:0.2769em;">
                     <span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
                <span class="mpunct">
                 ,
                </span>
                <span class="mspace" style="margin-right:0.1667em;">
                </span>
                <span class="mord mathnormal" style="margin-right:0.07153em;">
                 K
                </span>
                <span class="mord">
                 <span class="mord mathnormal" style="margin-right:0.13889em;">
                  W
                 </span>
                 <span class="msupsub">
                  <span class="vlist-t vlist-t2">
                   <span class="vlist-r">
                    <span class="vlist" style="height:0.8413em;">
                     <span style="top:-2.4413em;margin-left:-0.1389em;margin-right:0.05em;">
                      <span class="pstrut" style="height:2.7em;">
                      </span>
                      <span class="sizing reset-size6 size3 mtight">
                       <span class="mord mathnormal mtight">
                        i
                       </span>
                      </span>
                     </span>
                     <span style="top:-3.063em;margin-right:0.05em;">
                      <span class="pstrut" style="height:2.7em;">
                      </span>
                      <span class="sizing reset-size6 size3 mtight">
                       <span class="mord mathnormal mtight" style="margin-right:0.07153em;">
                        K
                       </span>
                      </span>
                     </span>
                    </span>
                    <span class="vlist-s">
                     ​
                    </span>
                   </span>
                   <span class="vlist-r">
                    <span class="vlist" style="height:0.2587em;">
                     <span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
                <span class="mpunct">
                 ,
                </span>
                <span class="mspace" style="margin-right:0.1667em;">
                </span>
                <span class="mord mathnormal" style="margin-right:0.22222em;">
                 V
                </span>
                <span class="mord">
                 <span class="mord mathnormal" style="margin-right:0.13889em;">
                  W
                 </span>
                 <span class="msupsub">
                  <span class="vlist-t vlist-t2">
                   <span class="vlist-r">
                    <span class="vlist" style="height:0.8413em;">
                     <span style="top:-2.4413em;margin-left:-0.1389em;margin-right:0.05em;">
                      <span class="pstrut" style="height:2.7em;">
                      </span>
                      <span class="sizing reset-size6 size3 mtight">
                       <span class="mord mathnormal mtight">
                        i
                       </span>
                      </span>
                     </span>
                     <span style="top:-3.063em;margin-right:0.05em;">
                      <span class="pstrut" style="height:2.7em;">
                      </span>
                      <span class="sizing reset-size6 size3 mtight">
                       <span class="mord mathnormal mtight" style="margin-right:0.22222em;">
                        V
                       </span>
                      </span>
                     </span>
                    </span>
                    <span class="vlist-s">
                     ​
                    </span>
                   </span>
                   <span class="vlist-r">
                    <span class="vlist" style="height:0.2587em;">
                     <span>
                     </span>
                    </span>
                   </span>
                  </span>
                 </span>
                </span>
                <span class="mclose">
                 )
                </span>
               </span>
              </span>
             </span>
            </span>
            .
           </p>
           <p>
            <code class="docutils literal notranslate">
             <span class="pre">
              forward()
             </span>
            </code>
            will use a special optimized implementation if all of the following
conditions are met:
           </p>
           <ul class="simple">
            <li>
             <p>
              self attention is being computed (i.e.,
              <code class="docutils literal notranslate">
               <span class="pre">
                query
               </span>
              </code>
              ,
              <code class="docutils literal notranslate">
               <span class="pre">
                key
               </span>
              </code>
              , and
              <code class="docutils literal notranslate">
               <span class="pre">
                value
               </span>
              </code>
              are the same tensor. This
restriction will be loosened in the future.)
             </p>
            </li>
            <li>
             <p>
              Either autograd is disabled (using
              <code class="docutils literal notranslate">
               <span class="pre">
                torch.inference_mode
               </span>
              </code>
              or
              <code class="docutils literal notranslate">
               <span class="pre">
                torch.no_grad
               </span>
              </code>
              ) or no tensor argument
              <code class="docutils literal notranslate">
               <span class="pre">
                requires_grad
               </span>
              </code>
             </p>
            </li>
            <li>
             <p>
              training is disabled (using
              <code class="docutils literal notranslate">
               <span class="pre">
                .eval()
               </span>
              </code>
              )
             </p>
            </li>
            <li>
             <p>
              dropout is 0
             </p>
            </li>
            <li>
             <p>
              <code class="docutils literal notranslate">
               <span class="pre">
                add_bias_kv
               </span>
              </code>
              is
              <code class="docutils literal notranslate">
               <span class="pre">
                False
               </span>
              </code>
             </p>
            </li>
            <li>
             <p>
              <code class="docutils literal notranslate">
               <span class="pre">
                add_zero_attn
               </span>
              </code>
              is
              <code class="docutils literal notranslate">
               <span class="pre">
                False
               </span>
              </code>
             </p>
            </li>
            <li>
             <p>
              <code class="docutils literal notranslate">
               <span class="pre">
                batch_first
               </span>
              </code>
              is
              <code class="docutils literal notranslate">
               <span class="pre">
                True
               </span>
              </code>
              and the input is batched
             </p>
            </li>
            <li>
             <p>
              <code class="docutils literal notranslate">
               <span class="pre">
                kdim
               </span>
              </code>
              and
              <code class="docutils literal notranslate">
               <span class="pre">
                vdim
               </span>
              </code>
              are equal to
              <code class="docutils literal notranslate">
               <span class="pre">
                embed_dim
               </span>
              </code>
             </p>
            </li>
            <li>
             <p>
              at most one of
              <code class="docutils literal notranslate">
               <span class="pre">
                key_padding_mask
               </span>
              </code>
              or
              <code class="docutils literal notranslate">
               <span class="pre">
                attn_mask
               </span>
              </code>
              is passed
             </p>
            </li>
            <li>
             <p>
              if a
              <a class="reference external" href="https://pytorch.org/docs/stable/nested.html">
               NestedTensor
              </a>
              is passed, neither
              <code class="docutils literal notranslate">
               <span class="pre">
                key_padding_mask
               </span>
              </code>
              nor
              <code class="docutils literal notranslate">
               <span class="pre">
                attn_mask
               </span>
              </code>
              is passed
             </p>
            </li>
           </ul>
           <p>
            If the optimized implementation is in use, a
            <a class="reference external" href="https://pytorch.org/docs/stable/nested.html">
             NestedTensor
            </a>
            can be passed for
            <code class="docutils literal notranslate">
             <span class="pre">
              query
             </span>
            </code>
            /
            <code class="docutils literal notranslate">
             <span class="pre">
              key
             </span>
            </code>
            /
            <code class="docutils literal notranslate">
             <span class="pre">
              value
             </span>
            </code>
            to represent padding more efficiently than using a
padding mask. In this case, a
            <a class="reference external" href="https://pytorch.org/docs/stable/nested.html">
             NestedTensor
            </a>
            will be returned, and an additional speedup proportional to the fraction of the input
that is padding can be expected.
           </p>
           <dl class="field-list simple">
            <dt class="field-odd">
             Parameters
            </dt>
            <dd class="field-odd">
             <ul class="simple">
              <li>
               <p>
                <strong>
                 embed_dim
                </strong>
                – Total dimension of the model.
               </p>
              </li>
              <li>
               <p>
                <strong>
                 num_heads
                </strong>
                – Number of parallel attention heads. Note that
                <code class="docutils literal notranslate">
                 <span class="pre">
                  embed_dim
                 </span>
                </code>
                will be split
across
                <code class="docutils literal notranslate">
                 <span class="pre">
                  num_heads
                 </span>
                </code>
                (i.e. each head will have dimension
                <code class="docutils literal notranslate">
                 <span class="pre">
                  embed_dim
                 </span>
                 <span class="pre">
                  //
                 </span>
                 <span class="pre">
                  num_heads
                 </span>
                </code>
                ).
               </p>
              </li>
              <li>
               <p>
                <strong>
                 dropout
                </strong>
                – Dropout probability on
                <code class="docutils literal notranslate">
                 <span class="pre">
                  attn_output_weights
                 </span>
                </code>
                . Default:
                <code class="docutils literal notranslate">
                 <span class="pre">
                  0.0
                 </span>
                </code>
                (no dropout).
               </p>
              </li>
              <li>
               <p>
                <strong>
                 bias
                </strong>
                – If specified, adds bias to input / output projection layers. Default:
                <code class="docutils literal notranslate">
                 <span class="pre">
                  True
                 </span>
                </code>
                .
               </p>
              </li>
              <li>
               <p>
                <strong>
                 add_bias_kv
                </strong>
                – If specified, adds bias to the key and value sequences at dim=0. Default:
                <code class="docutils literal notranslate">
                 <span class="pre">
                  False
                 </span>
                </code>
                .
               </p>
              </li>
              <li>
               <p>
                <strong>
                 add_zero_attn
                </strong>
                – If specified, adds a new batch of zeros to the key and value sequences at dim=1.
Default:
                <code class="docutils literal notranslate">
                 <span class="pre">
                  False
                 </span>
                </code>
                .
               </p>
              </li>
              <li>
               <p>
                <strong>
                 kdim
                </strong>
                – Total number of features for keys. Default:
                <code class="docutils literal notranslate">
                 <span class="pre">
                  None
                 </span>
                </code>
                (uses
                <code class="docutils literal notranslate">
                 <span class="pre">
                  kdim=embed_dim
                 </span>
                </code>
                ).
               </p>
              </li>
              <li>
               <p>
                <strong>
                 vdim
                </strong>
                – Total number of features for values. Default:
                <code class="docutils literal notranslate">
                 <span class="pre">
                  None
                 </span>
                </code>
                (uses
                <code class="docutils literal notranslate">
                 <span class="pre">
                  vdim=embed_dim
                 </span>
                </code>
                ).
               </p>
              </li>
              <li>
               <p>
                <strong>
                 batch_first
                </strong>
                – If
                <code class="docutils literal notranslate">
                 <span class="pre">
                  True
                 </span>
                </code>
                , then the input and output tensors are provided
as (batch, seq, feature). Default:
                <code class="docutils literal notranslate">
                 <span class="pre">
                  False
                 </span>
                </code>
                (seq, batch, feature).
               </p>
              </li>
             </ul>
            </dd>
           </dl>
           <p>
            Examples:
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">multihead_attn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MultiheadAttention</span><span class="p">(</span><span class="n">embed_dim</span><span class="p">,</span> <span class="n">num_heads</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">attn_output</span><span class="p">,</span> <span class="n">attn_output_weights</span> <span class="o">=</span> <span class="n">multihead_attn</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre>
            </div>
           </div>
           <dl class="py method">
            <dt id="torch.nn.MultiheadAttention.forward">
             <code class="sig-name descname">
              <span class="pre">
               forward
              </span>
             </code>
             <span class="sig-paren">
              (
             </span>
             <em class="sig-param">
              <span class="n">
               <span class="pre">
                query
               </span>
              </span>
             </em>
             ,
             <em class="sig-param">
              <span class="n">
               <span class="pre">
                key
               </span>
              </span>
             </em>
             ,
             <em class="sig-param">
              <span class="n">
               <span class="pre">
                value
               </span>
              </span>
             </em>
             ,
             <em class="sig-param">
              <span class="n">
               <span class="pre">
                key_padding_mask
               </span>
              </span>
              <span class="o">
               <span class="pre">
                =
               </span>
              </span>
              <span class="default_value">
               <span class="pre">
                None
               </span>
              </span>
             </em>
             ,
             <em class="sig-param">
              <span class="n">
               <span class="pre">
                need_weights
               </span>
              </span>
              <span class="o">
               <span class="pre">
                =
               </span>
              </span>
              <span class="default_value">
               <span class="pre">
                True
               </span>
              </span>
             </em>
             ,
             <em class="sig-param">
              <span class="n">
               <span class="pre">
                attn_mask
               </span>
              </span>
              <span class="o">
               <span class="pre">
                =
               </span>
              </span>
              <span class="default_value">
               <span class="pre">
                None
               </span>
              </span>
             </em>
             ,
             <em class="sig-param">
              <span class="n">
               <span class="pre">
                average_attn_weights
               </span>
              </span>
              <span class="o">
               <span class="pre">
                =
               </span>
              </span>
              <span class="default_value">
               <span class="pre">
                True
               </span>
              </span>
             </em>
             <span class="sig-paren">
              )
             </span>
             <a class="reference internal" href="../_modules/torch/nn/modules/activation.html#MultiheadAttention.forward">
              <span class="viewcode-link">
               <span class="pre">
                [source]
               </span>
              </span>
             </a>
             <a class="headerlink" href="#torch.nn.MultiheadAttention.forward" title="Permalink to this definition">
              ¶
             </a>
            </dt>
            <dd>
             <dl class="field-list simple">
              <dt class="field-odd">
               Parameters
              </dt>
              <dd class="field-odd">
               <ul class="simple">
                <li>
                 <p>
                  <strong>
                   query
                  </strong>
                  – Query embeddings of shape
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         L
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <msub>
                         <mi>
                          E
                         </mi>
                         <mi>
                          q
                         </mi>
                        </msub>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (L, E_q)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1.0361em;vertical-align:-0.2861em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal">
                       L
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord">
                       <span class="mord mathnormal" style="margin-right:0.05764em;">
                        E
                       </span>
                       <span class="msupsub">
                        <span class="vlist-t vlist-t2">
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.1514em;">
                           <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                            <span class="pstrut" style="height:2.7em;">
                            </span>
                            <span class="sizing reset-size6 size3 mtight">
                             <span class="mord mathnormal mtight" style="margin-right:0.03588em;">
                              q
                             </span>
                            </span>
                           </span>
                          </span>
                          <span class="vlist-s">
                           ​
                          </span>
                         </span>
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.2861em;">
                           <span>
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  for unbatched input,
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         L
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         N
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <msub>
                         <mi>
                          E
                         </mi>
                         <mi>
                          q
                         </mi>
                        </msub>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (L, N, E_q)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1.0361em;vertical-align:-0.2861em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal">
                       L
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                       N
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord">
                       <span class="mord mathnormal" style="margin-right:0.05764em;">
                        E
                       </span>
                       <span class="msupsub">
                        <span class="vlist-t vlist-t2">
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.1514em;">
                           <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                            <span class="pstrut" style="height:2.7em;">
                            </span>
                            <span class="sizing reset-size6 size3 mtight">
                             <span class="mord mathnormal mtight" style="margin-right:0.03588em;">
                              q
                             </span>
                            </span>
                           </span>
                          </span>
                          <span class="vlist-s">
                           ​
                          </span>
                         </span>
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.2861em;">
                           <span>
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  when
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    batch_first=False
                   </span>
                  </code>
                  or
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         N
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         L
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <msub>
                         <mi>
                          E
                         </mi>
                         <mi>
                          q
                         </mi>
                        </msub>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (N, L, E_q)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1.0361em;vertical-align:-0.2861em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                       N
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal">
                       L
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord">
                       <span class="mord mathnormal" style="margin-right:0.05764em;">
                        E
                       </span>
                       <span class="msupsub">
                        <span class="vlist-t vlist-t2">
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.1514em;">
                           <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                            <span class="pstrut" style="height:2.7em;">
                            </span>
                            <span class="sizing reset-size6 size3 mtight">
                             <span class="mord mathnormal mtight" style="margin-right:0.03588em;">
                              q
                             </span>
                            </span>
                           </span>
                          </span>
                          <span class="vlist-s">
                           ​
                          </span>
                         </span>
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.2861em;">
                           <span>
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  when
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    batch_first=True
                   </span>
                  </code>
                  , where
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mi>
                         L
                        </mi>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        L
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:0.6833em;">
                      </span>
                      <span class="mord mathnormal">
                       L
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  is the target sequence length,
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mi>
                         N
                        </mi>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        N
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:0.6833em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                       N
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  is the batch size, and
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <msub>
                         <mi>
                          E
                         </mi>
                         <mi>
                          q
                         </mi>
                        </msub>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        E_q
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:0.9694em;vertical-align:-0.2861em;">
                      </span>
                      <span class="mord">
                       <span class="mord mathnormal" style="margin-right:0.05764em;">
                        E
                       </span>
                       <span class="msupsub">
                        <span class="vlist-t vlist-t2">
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.1514em;">
                           <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                            <span class="pstrut" style="height:2.7em;">
                            </span>
                            <span class="sizing reset-size6 size3 mtight">
                             <span class="mord mathnormal mtight" style="margin-right:0.03588em;">
                              q
                             </span>
                            </span>
                           </span>
                          </span>
                          <span class="vlist-s">
                           ​
                          </span>
                         </span>
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.2861em;">
                           <span>
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  is the query embedding dimension
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    embed_dim
                   </span>
                  </code>
                  .
Queries are compared against key-value pairs to produce the output.
See “Attention Is All You Need” for more details.
                 </p>
                </li>
                <li>
                 <p>
                  <strong>
                   key
                  </strong>
                  – Key embeddings of shape
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         S
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <msub>
                         <mi>
                          E
                         </mi>
                         <mi>
                          k
                         </mi>
                        </msub>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (S, E_k)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1em;vertical-align:-0.25em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       S
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord">
                       <span class="mord mathnormal" style="margin-right:0.05764em;">
                        E
                       </span>
                       <span class="msupsub">
                        <span class="vlist-t vlist-t2">
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.3361em;">
                           <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                            <span class="pstrut" style="height:2.7em;">
                            </span>
                            <span class="sizing reset-size6 size3 mtight">
                             <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                              k
                             </span>
                            </span>
                           </span>
                          </span>
                          <span class="vlist-s">
                           ​
                          </span>
                         </span>
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.15em;">
                           <span>
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  for unbatched input,
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         S
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         N
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <msub>
                         <mi>
                          E
                         </mi>
                         <mi>
                          k
                         </mi>
                        </msub>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (S, N, E_k)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1em;vertical-align:-0.25em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       S
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                       N
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord">
                       <span class="mord mathnormal" style="margin-right:0.05764em;">
                        E
                       </span>
                       <span class="msupsub">
                        <span class="vlist-t vlist-t2">
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.3361em;">
                           <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                            <span class="pstrut" style="height:2.7em;">
                            </span>
                            <span class="sizing reset-size6 size3 mtight">
                             <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                              k
                             </span>
                            </span>
                           </span>
                          </span>
                          <span class="vlist-s">
                           ​
                          </span>
                         </span>
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.15em;">
                           <span>
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  when
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    batch_first=False
                   </span>
                  </code>
                  or
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         N
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         S
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <msub>
                         <mi>
                          E
                         </mi>
                         <mi>
                          k
                         </mi>
                        </msub>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (N, S, E_k)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1em;vertical-align:-0.25em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                       N
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       S
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord">
                       <span class="mord mathnormal" style="margin-right:0.05764em;">
                        E
                       </span>
                       <span class="msupsub">
                        <span class="vlist-t vlist-t2">
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.3361em;">
                           <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                            <span class="pstrut" style="height:2.7em;">
                            </span>
                            <span class="sizing reset-size6 size3 mtight">
                             <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                              k
                             </span>
                            </span>
                           </span>
                          </span>
                          <span class="vlist-s">
                           ​
                          </span>
                         </span>
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.15em;">
                           <span>
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  when
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    batch_first=True
                   </span>
                  </code>
                  , where
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mi>
                         S
                        </mi>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        S
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:0.6833em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       S
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  is the source sequence length,
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mi>
                         N
                        </mi>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        N
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:0.6833em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                       N
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  is the batch size, and
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <msub>
                         <mi>
                          E
                         </mi>
                         <mi>
                          k
                         </mi>
                        </msub>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        E_k
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:0.8333em;vertical-align:-0.15em;">
                      </span>
                      <span class="mord">
                       <span class="mord mathnormal" style="margin-right:0.05764em;">
                        E
                       </span>
                       <span class="msupsub">
                        <span class="vlist-t vlist-t2">
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.3361em;">
                           <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                            <span class="pstrut" style="height:2.7em;">
                            </span>
                            <span class="sizing reset-size6 size3 mtight">
                             <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                              k
                             </span>
                            </span>
                           </span>
                          </span>
                          <span class="vlist-s">
                           ​
                          </span>
                         </span>
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.15em;">
                           <span>
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  is the key embedding dimension
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    kdim
                   </span>
                  </code>
                  .
See “Attention Is All You Need” for more details.
                 </p>
                </li>
                <li>
                 <p>
                  <strong>
                   value
                  </strong>
                  – Value embeddings of shape
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         S
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <msub>
                         <mi>
                          E
                         </mi>
                         <mi>
                          v
                         </mi>
                        </msub>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (S, E_v)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1em;vertical-align:-0.25em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       S
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord">
                       <span class="mord mathnormal" style="margin-right:0.05764em;">
                        E
                       </span>
                       <span class="msupsub">
                        <span class="vlist-t vlist-t2">
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.1514em;">
                           <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                            <span class="pstrut" style="height:2.7em;">
                            </span>
                            <span class="sizing reset-size6 size3 mtight">
                             <span class="mord mathnormal mtight" style="margin-right:0.03588em;">
                              v
                             </span>
                            </span>
                           </span>
                          </span>
                          <span class="vlist-s">
                           ​
                          </span>
                         </span>
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.15em;">
                           <span>
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  for unbatched input,
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         S
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         N
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <msub>
                         <mi>
                          E
                         </mi>
                         <mi>
                          v
                         </mi>
                        </msub>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (S, N, E_v)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1em;vertical-align:-0.25em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       S
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                       N
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord">
                       <span class="mord mathnormal" style="margin-right:0.05764em;">
                        E
                       </span>
                       <span class="msupsub">
                        <span class="vlist-t vlist-t2">
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.1514em;">
                           <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                            <span class="pstrut" style="height:2.7em;">
                            </span>
                            <span class="sizing reset-size6 size3 mtight">
                             <span class="mord mathnormal mtight" style="margin-right:0.03588em;">
                              v
                             </span>
                            </span>
                           </span>
                          </span>
                          <span class="vlist-s">
                           ​
                          </span>
                         </span>
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.15em;">
                           <span>
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  when
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    batch_first=False
                   </span>
                  </code>
                  or
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         N
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         S
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <msub>
                         <mi>
                          E
                         </mi>
                         <mi>
                          v
                         </mi>
                        </msub>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (N, S, E_v)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1em;vertical-align:-0.25em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                       N
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       S
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord">
                       <span class="mord mathnormal" style="margin-right:0.05764em;">
                        E
                       </span>
                       <span class="msupsub">
                        <span class="vlist-t vlist-t2">
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.1514em;">
                           <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                            <span class="pstrut" style="height:2.7em;">
                            </span>
                            <span class="sizing reset-size6 size3 mtight">
                             <span class="mord mathnormal mtight" style="margin-right:0.03588em;">
                              v
                             </span>
                            </span>
                           </span>
                          </span>
                          <span class="vlist-s">
                           ​
                          </span>
                         </span>
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.15em;">
                           <span>
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  when
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    batch_first=True
                   </span>
                  </code>
                  , where
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mi>
                         S
                        </mi>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        S
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:0.6833em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       S
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  is the source
sequence length,
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mi>
                         N
                        </mi>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        N
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:0.6833em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                       N
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  is the batch size, and
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <msub>
                         <mi>
                          E
                         </mi>
                         <mi>
                          v
                         </mi>
                        </msub>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        E_v
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:0.8333em;vertical-align:-0.15em;">
                      </span>
                      <span class="mord">
                       <span class="mord mathnormal" style="margin-right:0.05764em;">
                        E
                       </span>
                       <span class="msupsub">
                        <span class="vlist-t vlist-t2">
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.1514em;">
                           <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                            <span class="pstrut" style="height:2.7em;">
                            </span>
                            <span class="sizing reset-size6 size3 mtight">
                             <span class="mord mathnormal mtight" style="margin-right:0.03588em;">
                              v
                             </span>
                            </span>
                           </span>
                          </span>
                          <span class="vlist-s">
                           ​
                          </span>
                         </span>
                         <span class="vlist-r">
                          <span class="vlist" style="height:0.15em;">
                           <span>
                           </span>
                          </span>
                         </span>
                        </span>
                       </span>
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  is the value embedding dimension
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    vdim
                   </span>
                  </code>
                  .
See “Attention Is All You Need” for more details.
                 </p>
                </li>
                <li>
                 <p>
                  <strong>
                   key_padding_mask
                  </strong>
                  – If specified, a mask of shape
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         N
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         S
                        </mi>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (N, S)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1em;vertical-align:-0.25em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                       N
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       S
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  indicating which elements within
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    key
                   </span>
                  </code>
                  to ignore for the purpose of attention (i.e. treat as “padding”). For unbatched
                  <cite>
                   query
                  </cite>
                  , shape should be
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         S
                        </mi>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (S)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1em;vertical-align:-0.25em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       S
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  .
Binary and byte masks are supported.
For a binary mask, a
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    True
                   </span>
                  </code>
                  value indicates that the corresponding
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    key
                   </span>
                  </code>
                  value will be ignored for
the purpose of attention. For a byte mask, a non-zero value indicates that the corresponding
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    key
                   </span>
                  </code>
                  value will be ignored.
                 </p>
                </li>
                <li>
                 <p>
                  <strong>
                   need_weights
                  </strong>
                  – If specified, returns
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    attn_output_weights
                   </span>
                  </code>
                  in addition to
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    attn_outputs
                   </span>
                  </code>
                  .
Default:
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    True
                   </span>
                  </code>
                  .
                 </p>
                </li>
                <li>
                 <p>
                  <strong>
                   attn_mask
                  </strong>
                  – If specified, a 2D or 3D mask preventing attention to certain positions. Must be of shape
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         L
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         S
                        </mi>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (L, S)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1em;vertical-align:-0.25em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal">
                       L
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       S
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  or
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         N
                        </mi>
                        <mo>
                         ⋅
                        </mo>
                        <mtext>
                         num_heads
                        </mtext>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         L
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         S
                        </mi>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (N\cdot\text{num\_heads}, L, S)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1em;vertical-align:-0.25em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                       N
                      </span>
                      <span class="mspace" style="margin-right:0.2222em;">
                      </span>
                      <span class="mbin">
                       ⋅
                      </span>
                      <span class="mspace" style="margin-right:0.2222em;">
                      </span>
                     </span>
                     <span class="base">
                      <span class="strut" style="height:1.06em;vertical-align:-0.31em;">
                      </span>
                      <span class="mord text">
                       <span class="mord">
                        num_heads
                       </span>
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal">
                       L
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       S
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  , where
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mi>
                         N
                        </mi>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        N
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:0.6833em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                       N
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  is the batch size,
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mi>
                         L
                        </mi>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        L
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:0.6833em;">
                      </span>
                      <span class="mord mathnormal">
                       L
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  is the target sequence length, and
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mi>
                         S
                        </mi>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        S
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:0.6833em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       S
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  is the source sequence length. A 2D mask will be
broadcasted across the batch while a 3D mask allows for a different mask for each entry in the batch.
Binary, byte, and float masks are supported. For a binary mask, a
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    True
                   </span>
                  </code>
                  value indicates that the
corresponding position is not allowed to attend. For a byte mask, a non-zero value indicates that the
corresponding position is not allowed to attend. For a float mask, the mask values will be added to
the attention weight.
                 </p>
                </li>
                <li>
                 <p>
                  <strong>
                   average_attn_weights
                  </strong>
                  – If true, indicates that the returned
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    attn_weights
                   </span>
                  </code>
                  should be averaged across
heads. Otherwise,
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    attn_weights
                   </span>
                  </code>
                  are provided separately per head. Note that this flag only has an
effect when
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    need_weights=True
                   </span>
                  </code>
                  . Default:
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    True
                   </span>
                  </code>
                  (i.e. average weights across heads)
                 </p>
                </li>
               </ul>
              </dd>
             </dl>
             <dl>
              <dt>
               Outputs:
              </dt>
              <dd>
               <ul class="simple">
                <li>
                 <p>
                  <strong>
                   attn_output
                  </strong>
                  - Attention outputs of shape
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         L
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         E
                        </mi>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (L, E)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1em;vertical-align:-0.25em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal">
                       L
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       E
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  when input is unbatched,
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         L
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         N
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         E
                        </mi>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (L, N, E)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1em;vertical-align:-0.25em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal">
                       L
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                       N
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       E
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  when
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    batch_first=False
                   </span>
                  </code>
                  or
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         N
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         L
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         E
                        </mi>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (N, L, E)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1em;vertical-align:-0.25em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                       N
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal">
                       L
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       E
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  when
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    batch_first=True
                   </span>
                  </code>
                  ,
where
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mi>
                         L
                        </mi>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        L
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:0.6833em;">
                      </span>
                      <span class="mord mathnormal">
                       L
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  is the target sequence length,
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mi>
                         N
                        </mi>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        N
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:0.6833em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                       N
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  is the batch size, and
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mi>
                         E
                        </mi>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        E
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:0.6833em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       E
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  is the
embedding dimension
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    embed_dim
                   </span>
                  </code>
                  .
                 </p>
                </li>
                <li>
                 <p>
                  <strong>
                   attn_output_weights
                  </strong>
                  - Only returned when
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    need_weights=True
                   </span>
                  </code>
                  . If
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    average_attn_weights=True
                   </span>
                  </code>
                  ,
returns attention weights averaged across heads of shape
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         L
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         S
                        </mi>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (L, S)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1em;vertical-align:-0.25em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal">
                       L
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       S
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  when input is unbatched or
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         N
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         L
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         S
                        </mi>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (N, L, S)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1em;vertical-align:-0.25em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                       N
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal">
                       L
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       S
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  , where
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mi>
                         N
                        </mi>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        N
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:0.6833em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                       N
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  is the batch size,
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mi>
                         L
                        </mi>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        L
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:0.6833em;">
                      </span>
                      <span class="mord mathnormal">
                       L
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  is the target sequence length, and
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mi>
                         S
                        </mi>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        S
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:0.6833em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       S
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  is the source sequence length. If
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    average_weights=False
                   </span>
                  </code>
                  , returns attention weights per
head of shape
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mtext>
                         num_heads
                        </mtext>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         L
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         S
                        </mi>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (\text{num\_heads}, L, S)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1.06em;vertical-align:-0.31em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord text">
                       <span class="mord">
                        num_heads
                       </span>
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal">
                       L
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       S
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  when input is unbatched or
                  <span class="math">
                   <span class="katex">
                    <span class="katex-mathml">
                     <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                       <mrow>
                        <mo stretchy="false">
                         (
                        </mo>
                        <mi>
                         N
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mtext>
                         num_heads
                        </mtext>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         L
                        </mi>
                        <mo separator="true">
                         ,
                        </mo>
                        <mi>
                         S
                        </mi>
                        <mo stretchy="false">
                         )
                        </mo>
                       </mrow>
                       <annotation encoding="application/x-tex">
                        (N, \text{num\_heads}, L, S)
                       </annotation>
                      </semantics>
                     </math>
                    </span>
                    <span aria-hidden="true" class="katex-html">
                     <span class="base">
                      <span class="strut" style="height:1.06em;vertical-align:-0.31em;">
                      </span>
                      <span class="mopen">
                       (
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                       N
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord text">
                       <span class="mord">
                        num_heads
                       </span>
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal">
                       L
                      </span>
                      <span class="mpunct">
                       ,
                      </span>
                      <span class="mspace" style="margin-right:0.1667em;">
                      </span>
                      <span class="mord mathnormal" style="margin-right:0.05764em;">
                       S
                      </span>
                      <span class="mclose">
                       )
                      </span>
                     </span>
                    </span>
                   </span>
                  </span>
                  .
                 </p>
                </li>
               </ul>
               <div class="admonition note">
                <p class="admonition-title">
                 Note
                </p>
                <p>
                 <cite>
                  batch_first
                 </cite>
                 argument is ignored for unbatched inputs.
                </p>
               </div>
              </dd>
             </dl>
            </dd>
           </dl>
          </dd>
         </dl>
        </div>
       </article>
      </div>
     </div>
    </div>
   </section>
  </div>
 </body>
</html>