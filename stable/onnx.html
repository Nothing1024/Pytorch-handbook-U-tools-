<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
 <!--<![endif]-->
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   torch.onnx — PyTorch 1.10 documentation
  </title>
  <!-- <link rel="stylesheet" href="_static/pygments.css" type="text/css" /> -->
  <!-- Google Analytics -->
  <!-- Preload the theme fonts -->
  <!-- Preload the katex fonts -->
 </head>
 <body class="pytorch-body">
  <div class="pytorch-container">
   <section class="pytorch-content-wrap" data-toggle="wy-nav-shift" id="pytorch-content-wrap">
    <div class="pytorch-content-left">
     <div class="rst-content">
      <div class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
       <article class="pytorch-article" id="pytorch-article" itemprop="articleBody">
        <div class="section" id="torch-onnx">
         <h1>
          torch.onnx
          <a class="headerlink" href="#torch-onnx" title="Permalink to this headline">
           ¶
          </a>
         </h1>
         <div class="contents local topic" id="contents">
          <ul class="simple">
           <li>
            <p>
             <a class="reference internal" href="#example-alexnet-from-pytorch-to-onnx" id="id4">
              Example: AlexNet from PyTorch to ONNX
             </a>
            </p>
           </li>
           <li>
            <p>
             <a class="reference internal" href="#tracing-vs-scripting" id="id5">
              Tracing vs Scripting
             </a>
            </p>
           </li>
           <li>
            <p>
             <a class="reference internal" href="#avoiding-pitfalls" id="id6">
              Avoiding Pitfalls
             </a>
            </p>
            <ul>
             <li>
              <p>
               <a class="reference internal" href="#avoid-numpy-and-built-in-python-types" id="id7">
                Avoid NumPy and built-in Python types
               </a>
              </p>
             </li>
             <li>
              <p>
               <a class="reference internal" href="#avoid-tensor-data" id="id8">
                Avoid Tensor.data
               </a>
              </p>
             </li>
            </ul>
           </li>
           <li>
            <p>
             <a class="reference internal" href="#limitations" id="id9">
              Limitations
             </a>
            </p>
            <ul>
             <li>
              <p>
               <a class="reference internal" href="#types" id="id10">
                Types
               </a>
              </p>
             </li>
             <li>
              <p>
               <a class="reference internal" href="#differences-in-operator-implementations" id="id11">
                Differences in Operator Implementations
               </a>
              </p>
             </li>
             <li>
              <p>
               <a class="reference internal" href="#unsupported-tensor-indexing-patterns" id="id12">
                Unsupported Tensor Indexing Patterns
               </a>
              </p>
              <ul>
               <li>
                <p>
                 <a class="reference internal" href="#reads-gets" id="id13">
                  Reads / Gets
                 </a>
                </p>
               </li>
               <li>
                <p>
                 <a class="reference internal" href="#writes-sets" id="id14">
                  Writes / Sets
                 </a>
                </p>
               </li>
              </ul>
             </li>
            </ul>
           </li>
           <li>
            <p>
             <a class="reference internal" href="#adding-support-for-operators" id="id15">
              Adding support for operators
             </a>
            </p>
            <ul>
             <li>
              <p>
               <a class="reference internal" href="#aten-operators" id="id16">
                ATen operators
               </a>
              </p>
             </li>
             <li>
              <p>
               <a class="reference internal" href="#torch-autograd-functions" id="id17">
                torch.autograd.Functions
               </a>
              </p>
              <ul>
               <li>
                <p>
                 <a class="reference internal" href="#static-symbolic-method" id="id18">
                  Static Symbolic Method
                 </a>
                </p>
               </li>
               <li>
                <p>
                 <a class="reference internal" href="#pythonop-symbolic" id="id19">
                  PythonOp Symbolic
                 </a>
                </p>
               </li>
              </ul>
             </li>
             <li>
              <p>
               <a class="reference internal" href="#custom-operators" id="id20">
                Custom operators
               </a>
              </p>
             </li>
            </ul>
           </li>
           <li>
            <p>
             <a class="reference internal" href="#frequently-asked-questions" id="id21">
              Frequently Asked Questions
             </a>
            </p>
           </li>
           <li>
            <p>
             <a class="reference internal" href="#functions" id="id22">
              Functions
             </a>
            </p>
           </li>
          </ul>
         </div>
         <span class="target" id="module-torch.onnx">
         </span>
         <p>
          <a class="reference external" href="https://onnx.ai/">
           Open Neural Network eXchange (ONNX)
          </a>
          is an open standard
format for representing machine learning models. The torch.onnx module can export
PyTorch models to ONNX. The model can then be consumed by any of the many
          <a class="reference external" href="https://onnx.ai/supported-tools.html#deployModel">
           runtimes that support ONNX
          </a>
          .
         </p>
         <div class="section" id="example-alexnet-from-pytorch-to-onnx">
          <h2>
           <a class="toc-backref" href="#id4">
            Example: AlexNet from PyTorch to ONNX
           </a>
           <a class="headerlink" href="#example-alexnet-from-pytorch-to-onnx" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           Here is a simple script which exports a pretrained AlexNet to an ONNX file named
           <code class="docutils literal notranslate">
            <span class="pre">
             alexnet.onnx
            </span>
           </code>
           .
The call to
           <code class="docutils literal notranslate">
            <span class="pre">
             torch.onnx.export
            </span>
           </code>
           runs the model once to trace its execution and then exports the
traced model to the specified file:
          </p>
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torchvision</span>

<span class="n">dummy_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">"cuda"</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">alexnet</span><span class="p">(</span><span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>

<span class="c1"># Providing input and output names sets the display names for values</span>
<span class="c1"># within the model's graph. Setting these does not change the semantics</span>
<span class="c1"># of the graph; it is only for readability.</span>
<span class="c1">#</span>
<span class="c1"># The inputs to the network consist of the flat list of inputs (i.e.</span>
<span class="c1"># the values you would pass to the forward() method) followed by the</span>
<span class="c1"># flat list of parameters. You can partially specify names, i.e. provide</span>
<span class="c1"># a list here shorter than the number of inputs to the model, and we will</span>
<span class="c1"># only set that subset of names, starting from the beginning.</span>
<span class="n">input_names</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">"actual_input_1"</span> <span class="p">]</span> <span class="o">+</span> <span class="p">[</span> <span class="s2">"learned_</span><span class="si">%d</span><span class="s2">"</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="p">]</span>
<span class="n">output_names</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">"output1"</span> <span class="p">]</span>

<span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dummy_input</span><span class="p">,</span> <span class="s2">"alexnet.onnx"</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">input_names</span><span class="o">=</span><span class="n">input_names</span><span class="p">,</span> <span class="n">output_names</span><span class="o">=</span><span class="n">output_names</span><span class="p">)</span>
</pre>
           </div>
          </div>
          <p>
           The resulting
           <code class="docutils literal notranslate">
            <span class="pre">
             alexnet.onnx
            </span>
           </code>
           file contains a binary
           <a class="reference external" href="https://developers.google.com/protocol-buffers/">
            protocol buffer
           </a>
           which contains both the network structure and parameters of the model you exported
(in this case, AlexNet).  The argument
           <code class="docutils literal notranslate">
            <span class="pre">
             verbose=True
            </span>
           </code>
           causes the
exporter to print out a human-readable representation of the model:
          </p>
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1"># These are the inputs and parameters to the network, which have taken on</span>
<span class="c1"># the names we specified earlier.</span>
<span class="n">graph</span><span class="p">(</span><span class="o">%</span><span class="n">actual_input_1</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">)</span>
      <span class="o">%</span><span class="n">learned_0</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
      <span class="o">%</span><span class="n">learned_1</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>
      <span class="o">%</span><span class="n">learned_2</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
      <span class="o">%</span><span class="n">learned_3</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">192</span><span class="p">)</span>
      <span class="c1"># ---- omitted for brevity ----</span>
      <span class="o">%</span><span class="n">learned_14</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">4096</span><span class="p">)</span>
      <span class="o">%</span><span class="n">learned_15</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span> <span class="p">{</span>
  <span class="c1"># Every statement consists of some output tensors (and their types),</span>
  <span class="c1"># the operator to be run (with its attributes, e.g., kernels, strides,</span>
  <span class="c1"># etc.), its input tensors (%actual_input_1, %learned_0, %learned_1)</span>
  <span class="o">%</span><span class="mi">17</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">55</span><span class="p">)</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Conv</span><span class="p">[</span><span class="n">dilations</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">group</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="o">=</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span> <span class="n">pads</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]](</span><span class="o">%</span><span class="n">actual_input_1</span><span class="p">,</span> <span class="o">%</span><span class="n">learned_0</span><span class="p">,</span> <span class="o">%</span><span class="n">learned_1</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span><span class="o">/</span><span class="n">Sequential</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">/</span><span class="n">Conv2d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="o">%</span><span class="mi">18</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">55</span><span class="p">)</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Relu</span><span class="p">(</span><span class="o">%</span><span class="mi">17</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span><span class="o">/</span><span class="n">Sequential</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">/</span><span class="n">ReLU</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="o">%</span><span class="mi">19</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">27</span><span class="p">)</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">MaxPool</span><span class="p">[</span><span class="n">kernel_shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">pads</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]](</span><span class="o">%</span><span class="mi">18</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span><span class="o">/</span><span class="n">Sequential</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">/</span><span class="n">MaxPool2d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="c1"># ---- omitted for brevity ----</span>
  <span class="o">%</span><span class="mi">29</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">MaxPool</span><span class="p">[</span><span class="n">kernel_shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">pads</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]](</span><span class="o">%</span><span class="mi">28</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span><span class="o">/</span><span class="n">Sequential</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">/</span><span class="n">MaxPool2d</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
  <span class="c1"># Dynamic means that the shape is not known. This may be because of a</span>
  <span class="c1"># limitation of our implementation (which we would like to fix in a</span>
  <span class="c1"># future release) or shapes which are truly dynamic.</span>
  <span class="o">%</span><span class="mi">30</span> <span class="p">:</span> <span class="n">Dynamic</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Shape</span><span class="p">(</span><span class="o">%</span><span class="mi">29</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span>
  <span class="o">%</span><span class="mi">31</span> <span class="p">:</span> <span class="n">Dynamic</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Slice</span><span class="p">[</span><span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ends</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">starts</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]](</span><span class="o">%</span><span class="mi">30</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span>
  <span class="o">%</span><span class="mi">32</span> <span class="p">:</span> <span class="n">Long</span><span class="p">()</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Squeeze</span><span class="p">[</span><span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]](</span><span class="o">%</span><span class="mi">31</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span>
  <span class="o">%</span><span class="mi">33</span> <span class="p">:</span> <span class="n">Long</span><span class="p">()</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="p">{</span><span class="mi">9216</span><span class="p">}](),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span>
  <span class="c1"># ---- omitted for brevity ----</span>
  <span class="o">%</span><span class="n">output1</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Gemm</span><span class="p">[</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">broadcast</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">transB</span><span class="o">=</span><span class="mi">1</span><span class="p">](</span><span class="o">%</span><span class="mi">45</span><span class="p">,</span> <span class="o">%</span><span class="n">learned_14</span><span class="p">,</span> <span class="o">%</span><span class="n">learned_15</span><span class="p">),</span> <span class="n">scope</span><span class="p">:</span> <span class="n">AlexNet</span><span class="o">/</span><span class="n">Sequential</span><span class="p">[</span><span class="n">classifier</span><span class="p">]</span><span class="o">/</span><span class="n">Linear</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">%</span><span class="n">output1</span><span class="p">);</span>
<span class="p">}</span>
</pre>
           </div>
          </div>
          <p>
           You can also verify the output using the
           <a class="reference external" href="https://github.com/onnx/onnx/">
            ONNX
           </a>
           library,
which you can install using
           <a class="reference external" href="https://anaconda.org">
            conda
           </a>
           :
          </p>
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">onnx</span>
</pre>
           </div>
          </div>
          <p>
           Then, you can run:
          </p>
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">import</span> <span class="nn">onnx</span>

<span class="c1"># Load the ONNX model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">onnx</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">"alexnet.onnx"</span><span class="p">)</span>

<span class="c1"># Check that the model is well formed</span>
<span class="n">onnx</span><span class="o">.</span><span class="n">checker</span><span class="o">.</span><span class="n">check_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="c1"># Print a human readable representation of the graph</span>
<span class="nb">print</span><span class="p">(</span><span class="n">onnx</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">printable_graph</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">graph</span><span class="p">))</span>
</pre>
           </div>
          </div>
          <p>
           You can also run the exported model with one of the many
           <a class="reference external" href="https://onnx.ai/supported-tools.html#deployModel">
            runtimes that support ONNX
           </a>
           .
For example after installing
           <a class="reference external" href="https://www.onnxruntime.ai">
            ONNX Runtime
           </a>
           , you can
load and run the model:
          </p>
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">import</span> <span class="nn">onnxruntime</span> <span class="k">as</span> <span class="nn">ort</span>

<span class="n">ort_session</span> <span class="o">=</span> <span class="n">ort</span><span class="o">.</span><span class="n">InferenceSession</span><span class="p">(</span><span class="s2">"alexnet.onnx"</span><span class="p">)</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">ort_session</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="kc">None</span><span class="p">,</span>
    <span class="p">{</span><span class="s2">"actual_input_1"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)},</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre>
           </div>
          </div>
          <p>
           Here is a more involved
           <a class="reference external" href="https://pytorch.org/tutorials/advanced/super_resolution_with_onnxruntime.html">
            tutorial on exporting a model and running it with ONNX Runtime
           </a>
           .
          </p>
         </div>
         <div class="section" id="tracing-vs-scripting">
          <span id="id2">
          </span>
          <h2>
           <a class="toc-backref" href="#id5">
            Tracing vs Scripting
           </a>
           <a class="headerlink" href="#tracing-vs-scripting" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           Internally,
           <code class="docutils literal notranslate">
            <span class="pre">
             torch.onnx.export()
            </span>
           </code>
           requires a
           <a class="reference internal" href="generated/torch.jit.ScriptModule.html#torch.jit.ScriptModule" title="torch.jit.ScriptModule">
            <code class="xref py py-class docutils literal notranslate">
             <span class="pre">
              torch.jit.ScriptModule
             </span>
            </code>
           </a>
           rather than
a
           <a class="reference internal" href="generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module">
            <code class="xref py py-class docutils literal notranslate">
             <span class="pre">
              torch.nn.Module
             </span>
            </code>
           </a>
           . If the passed-in model is not already a
           <code class="docutils literal notranslate">
            <span class="pre">
             ScriptModule
            </span>
           </code>
           ,
           <code class="docutils literal notranslate">
            <span class="pre">
             export()
            </span>
           </code>
           will use
           <em>
            tracing
           </em>
           to convert it to one:
          </p>
          <ul class="simple">
           <li>
            <p>
             <strong>
              Tracing
             </strong>
             : If
             <code class="docutils literal notranslate">
              <span class="pre">
               torch.onnx.export()
              </span>
             </code>
             is called with a Module that is not already a
             <code class="docutils literal notranslate">
              <span class="pre">
               ScriptModule
              </span>
             </code>
             , it first does the equivalent of
             <a class="reference internal" href="generated/torch.jit.trace.html#torch.jit.trace" title="torch.jit.trace">
              <code class="xref py py-func docutils literal notranslate">
               <span class="pre">
                torch.jit.trace()
               </span>
              </code>
             </a>
             , which executes the model
once with the given
             <code class="docutils literal notranslate">
              <span class="pre">
               args
              </span>
             </code>
             and records all operations that happen during that execution. This
means that if your model is dynamic, e.g., changes behavior depending on input data, the exported
model will
             <em>
              not
             </em>
             capture this dynamic behavior.  Similarly, a trace is likely to be valid only for
a specific input size. We recommend examining the exported model and making sure the operators look
reasonable. Tracing will unroll loops and if statements, exporting a static graph that is exactly
the same as the traced run. If you want to export your model with dynamic control flow, you will
need to use
             <em>
              scripting
             </em>
             .
            </p>
           </li>
           <li>
            <p>
             <strong>
              Scripting
             </strong>
             : Compiling a model via scripting preserves dynamic control flow and is valid for inputs
of different sizes. To use scripting:
            </p>
            <ul>
             <li>
              <p>
               Use
               <a class="reference internal" href="generated/torch.jit.script.html#torch.jit.script" title="torch.jit.script">
                <code class="xref py py-func docutils literal notranslate">
                 <span class="pre">
                  torch.jit.script()
                 </span>
                </code>
               </a>
               to produce a
               <code class="docutils literal notranslate">
                <span class="pre">
                 ScriptModule
                </span>
               </code>
               .
              </p>
             </li>
             <li>
              <p>
               Call
               <code class="docutils literal notranslate">
                <span class="pre">
                 torch.onnx.export()
                </span>
               </code>
               with the
               <code class="docutils literal notranslate">
                <span class="pre">
                 ScriptModule
                </span>
               </code>
               as the model, and set the
               <code class="docutils literal notranslate">
                <span class="pre">
                 example_outputs
                </span>
               </code>
               arg. This is required so that the types and shapes of the outputs can be
captured without executing the model.
              </p>
             </li>
            </ul>
           </li>
          </ul>
          <p>
           See
           <a class="reference external" href="https://pytorch.org/tutorials/beginner/Intro_to_TorchScript_tutorial.html">
            Introduction to TorchScript
           </a>
           and
           <a class="reference external" href="jit.html">
            TorchScript
           </a>
           for more details, including how to compose tracing and scripting to suit the
particular requirements of different models.
          </p>
         </div>
         <div class="section" id="avoiding-pitfalls">
          <h2>
           <a class="toc-backref" href="#id6">
            Avoiding Pitfalls
           </a>
           <a class="headerlink" href="#avoiding-pitfalls" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <div class="section" id="avoid-numpy-and-built-in-python-types">
           <h3>
            <a class="toc-backref" href="#id7">
             Avoid NumPy and built-in Python types
            </a>
            <a class="headerlink" href="#avoid-numpy-and-built-in-python-types" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            PyTorch models can be written using NumPy or Python types and functions, but
during
            <a class="reference internal" href="#tracing-vs-scripting">
             <span class="std std-ref">
              tracing
             </span>
            </a>
            , any variables of NumPy or Python
types (rather than torch.Tensor) are converted to constants, which will produce
the wrong result if those values should change depending on the inputs.
           </p>
           <p>
            For example, rather than using numpy functions on numpy.ndarrays:
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1"># Bad! Will be replaced with constants during tracing.</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre>
            </div>
           </div>
           <p>
            Use torch operators on torch.Tensors:
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1"># Good! Tensor operations will be captured during tracing.</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre>
            </div>
           </div>
           <p>
            And rather than using
            <a class="reference internal" href="generated/torch.Tensor.item.html#torch.Tensor.item" title="torch.Tensor.item">
             <code class="xref py py-func docutils literal notranslate">
              <span class="pre">
               torch.Tensor.item()
              </span>
             </code>
            </a>
            (which converts a Tensor to a Python
built-in number):
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1"># Bad! y.item() will be replaced with a constant during tracing.</span>
<span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre>
            </div>
           </div>
           <p>
            Use torch’s support for implicit casting of single-element tensors:
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1"># Good! y will be preserved as a variable during tracing.</span>
<span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre>
            </div>
           </div>
          </div>
          <div class="section" id="avoid-tensor-data">
           <h3>
            <a class="toc-backref" href="#id8">
             Avoid Tensor.data
            </a>
            <a class="headerlink" href="#avoid-tensor-data" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            Using the Tensor.data field can produce an incorrect trace and therefore an incorrect ONNX graph.
Use
            <a class="reference internal" href="generated/torch.Tensor.detach.html#torch.Tensor.detach" title="torch.Tensor.detach">
             <code class="xref py py-func docutils literal notranslate">
              <span class="pre">
               torch.Tensor.detach()
              </span>
             </code>
            </a>
            instead. (Work is ongoing to
            <a class="reference external" href="https://github.com/pytorch/pytorch/issues/30987">
             remove Tensor.data entirely
            </a>
            ).
           </p>
          </div>
         </div>
         <div class="section" id="limitations">
          <h2>
           <a class="toc-backref" href="#id9">
            Limitations
           </a>
           <a class="headerlink" href="#limitations" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <div class="section" id="types">
           <h3>
            <a class="toc-backref" href="#id10">
             Types
            </a>
            <a class="headerlink" href="#types" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <ul class="simple">
            <li>
             <p>
              Only torch.Tensors, numeric types that can be trivially converted to torch.Tensors (e.g. float, int),
and tuples and lists of those types are supported as model inputs or outputs. Dict and str inputs and
outputs are accepted in
              <a class="reference internal" href="#tracing-vs-scripting">
               <span class="std std-ref">
                tracing
               </span>
              </a>
              mode, but:
             </p>
             <ul>
              <li>
               <p>
                Any computation that depends on the value of a dict or a str input will be replaced with the
constant value seen during the one traced execution.
               </p>
              </li>
              <li>
               <p>
                Any output that is a dict will be silently replaced with a flattened sequence of its values
(keys will be removed). E.g.
                <code class="docutils literal notranslate">
                 <span class="pre">
                  {"foo":
                 </span>
                 <span class="pre">
                  1,
                 </span>
                 <span class="pre">
                  "bar":
                 </span>
                 <span class="pre">
                  2}
                 </span>
                </code>
                becomes
                <code class="docutils literal notranslate">
                 <span class="pre">
                  (1,
                 </span>
                 <span class="pre">
                  2)
                 </span>
                </code>
                .
               </p>
              </li>
              <li>
               <p>
                Any output that is a str will be silently removed.
               </p>
              </li>
             </ul>
            </li>
            <li>
             <p>
              Certain operations involving tuples and lists are not supported in
              <a class="reference internal" href="#tracing-vs-scripting">
               <span class="std std-ref">
                scripting
               </span>
              </a>
              mode due to limited support in ONNX for nested sequences.
In particular appending a tuple to a list is not supported. In tracing mode, the nested sequences
will be flattened automatically during the tracing.
             </p>
            </li>
           </ul>
          </div>
          <div class="section" id="differences-in-operator-implementations">
           <h3>
            <a class="toc-backref" href="#id11">
             Differences in Operator Implementations
            </a>
            <a class="headerlink" href="#differences-in-operator-implementations" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            Due to differences in implementations of operators, running the exported model on different runtimes
may produce different results from each other or from PyTorch. Normally these differences are
numerically small, so this should only be a concern if your application is sensitive to these
small differences.
           </p>
          </div>
          <div class="section" id="unsupported-tensor-indexing-patterns">
           <span id="tensor-indexing">
           </span>
           <h3>
            <a class="toc-backref" href="#id12">
             Unsupported Tensor Indexing Patterns
            </a>
            <a class="headerlink" href="#unsupported-tensor-indexing-patterns" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            Tensor indexing patterns that cannot be exported are listed below.
If you are experiencing issues exporting a model that does not include any of
the unsupported patterns below, please double check that you are exporting with
the latest
            <code class="docutils literal notranslate">
             <span class="pre">
              opset_version
             </span>
            </code>
            .
           </p>
           <div class="section" id="reads-gets">
            <h4>
             <a class="toc-backref" href="#id13">
              Reads / Gets
             </a>
             <a class="headerlink" href="#reads-gets" title="Permalink to this headline">
              ¶
             </a>
            </h4>
            <p>
             When indexing into a tensor for reading, the following patterns are not supported:
            </p>
            <div class="highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1"># Tensor indices that includes negative values.</span>
<span class="n">data</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span>
</pre>
             </div>
            </div>
           </div>
           <div class="section" id="writes-sets">
            <h4>
             <a class="toc-backref" href="#id14">
              Writes / Sets
             </a>
             <a class="headerlink" href="#writes-sets" title="Permalink to this headline">
              ¶
             </a>
            </h4>
            <p>
             When indexing into a Tensor for writing, the following patterns are not supported:
            </p>
            <div class="highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1"># Multiple tensor indices if any has rank &gt;= 2</span>
<span class="n">data</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span> <span class="o">=</span> <span class="n">new_data</span>

<span class="c1"># Multiple tensor indices that are not consecutive</span>
<span class="n">data</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="p">:,</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])]</span> <span class="o">=</span> <span class="n">new_data</span>

<span class="c1"># Tensor indices that includes negative values.</span>
<span class="n">data</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])]</span> <span class="o">=</span> <span class="n">new_data</span>
</pre>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="adding-support-for-operators">
          <h2>
           <a class="toc-backref" href="#id15">
            Adding support for operators
           </a>
           <a class="headerlink" href="#adding-support-for-operators" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           When exporting a model that includes unsupported operators, you’ll see an error message like:
          </p>
          <div class="highlight-text notranslate">
           <div class="highlight">
            <pre><span></span>RuntimeError: ONNX export failed: Couldn't export operator foo
</pre>
           </div>
          </div>
          <p>
           When that happens, you’ll need to either change the model to not use that operator,
or add support for the operator.
          </p>
          <p>
           Adding support for operators requires contributing a change to PyTorch’s source code.
See
           <a class="reference external" href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">
            CONTRIBUTING
           </a>
           for general instructions on that, and below for specific instructions on the code
changes required for supporting an operator.
          </p>
          <p>
           During export, each node in the TorchScript graph is visited in topological order.
Upon visiting a node, the exporter tries to find a registered symbolic functions for
that node. Symbolic functions are implemented in Python. A symbolic function for
an op named
           <code class="docutils literal notranslate">
            <span class="pre">
             foo
            </span>
           </code>
           would look something like:
          </p>
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span>
  <span class="n">g</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span>
  <span class="n">input_0</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">Value</span><span class="p">,</span>
  <span class="n">input_1</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">Value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">Value</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">Value</span><span class="p">]]:</span>
  <span class="sd">"""</span>
<span class="sd">  Modifies g (e.g., using "g.op()"), adding the ONNX operations representing</span>
<span class="sd">  this PyTorch function.</span>

<span class="sd">  Args:</span>
<span class="sd">    g (Graph): graph to write the ONNX representation into.</span>
<span class="sd">    input_0 (Value): value representing the variables which contain</span>
<span class="sd">        the first input for this operator.</span>
<span class="sd">    input_1 (Value): value representing the variables which contain</span>
<span class="sd">        the second input for this operator.</span>

<span class="sd">  Returns:</span>
<span class="sd">    A Value or List of Values specifying the ONNX nodes that compute something</span>
<span class="sd">    equivalent to the original PyTorch operator with the given inputs.</span>
<span class="sd">    Returns None if it cannot be converted to ONNX.</span>
<span class="sd">  """</span>
  <span class="o">...</span>
</pre>
           </div>
          </div>
          <p>
           The
           <code class="docutils literal notranslate">
            <span class="pre">
             torch._C
            </span>
           </code>
           types are Python wrappers around the types defined in C++ in
           <a class="reference external" href="https://github.com/pytorch/pytorch/blob/master/torch/csrc/jit/ir/ir.h">
            ir.h
           </a>
           .
          </p>
          <p>
           The process for adding a symbolic function depends on the type of operator.
          </p>
          <div class="section" id="aten-operators">
           <span id="adding-support-aten">
           </span>
           <h3>
            <a class="toc-backref" href="#id16">
             ATen operators
            </a>
            <a class="headerlink" href="#aten-operators" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            <a class="reference external" href="https://pytorch.org/cppdocs/#aten">
             ATen
            </a>
            is PyTorch’s built-in tensor library.
If the operator is an ATen operator (shows up in the TorchScript graph with the prefix
            <code class="docutils literal notranslate">
             <span class="pre">
              aten::
             </span>
            </code>
            ):
           </p>
           <ul class="simple">
            <li>
             <p>
              Define the symbolic function in
              <code class="docutils literal notranslate">
               <span class="pre">
                torch/onnx/symbolic_opset&lt;version&gt;.py
               </span>
              </code>
              , for example
              <a class="reference external" href="https://github.com/pytorch/pytorch/blob/master/torch/onnx/symbolic_opset9.py">
               torch/onnx/symbolic_opset9.py
              </a>
              .
Make sure the function has the same name as the ATen function, which may be declared in
              <code class="docutils literal notranslate">
               <span class="pre">
                torch/_C/_VariableFunctions.pyi
               </span>
              </code>
              or
              <code class="docutils literal notranslate">
               <span class="pre">
                torch/nn/functional.pyi
               </span>
              </code>
              (these files are generated at
build time, so will not appear in your checkout until you build PyTorch).
             </p>
            </li>
            <li>
             <p>
              The first arg is always the ONNX graph that is being built for export.
Other arg names must EXACTLY match the names in the
              <code class="docutils literal notranslate">
               <span class="pre">
                .pyi
               </span>
              </code>
              file,
because dispatch is done with keyword arguments.
             </p>
            </li>
            <li>
             <p>
              In the symbolic function, if the operator is in the
              <a class="reference external" href="https://github.com/onnx/onnx/blob/master/docs/Operators.md">
               ONNX standard operator set
              </a>
              ,
we only need to create a node to represent the ONNX operator in the graph.
If not, we can create a graph of several standard operators that have
equivalent semantics to the ATen operator.
             </p>
            </li>
            <li>
             <p>
              If an input argument is a Tensor, but ONNX asks for a scalar, we have to
explicitly do the conversion.
              <code class="xref py py-func docutils literal notranslate">
               <span class="pre">
                symbolic_helper._scalar()
               </span>
              </code>
              can convert a
scalar tensor into a python scalar, and
              <code class="xref py py-func docutils literal notranslate">
               <span class="pre">
                symbolic_helper._if_scalar_type_as()
               </span>
              </code>
              can turn a Python scalar into a
PyTorch tensor.
             </p>
            </li>
           </ul>
           <p>
            Here is an example of handling missing symbolic function for the
            <code class="docutils literal notranslate">
             <span class="pre">
              ELU
             </span>
            </code>
            operator.
           </p>
           <p>
            If we run the following code:
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="nb">print</span><span class="p">(</span>
  <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ELU</span><span class="p">(),</span> <span class="c1"># module</span>
                  <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># example input</span>
                  <span class="p">)</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</pre>
            </div>
           </div>
           <p>
            We see something like:
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="n">graph</span><span class="p">(</span><span class="o">%</span><span class="bp">self</span> <span class="p">:</span> <span class="n">__torch__</span><span class="o">.</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">activation</span><span class="o">.</span><span class="n">___torch_mangle_0</span><span class="o">.</span><span class="n">ELU</span><span class="p">,</span>
      <span class="o">%</span><span class="nb">input</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">requires_grad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">cpu</span><span class="p">)):</span>
  <span class="o">%</span><span class="mi">4</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mf">1.</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">5</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">6</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">]()</span>
  <span class="o">%</span><span class="mi">7</span> <span class="p">:</span> <span class="n">Float</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">requires_grad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">cpu</span><span class="p">)</span> <span class="o">=</span> <span class="n">aten</span><span class="p">::</span><span class="n">elu</span><span class="p">(</span><span class="o">%</span><span class="nb">input</span><span class="p">,</span> <span class="o">%</span><span class="mi">4</span><span class="p">,</span> <span class="o">%</span><span class="mi">5</span><span class="p">,</span> <span class="o">%</span><span class="mi">6</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">%</span><span class="mi">7</span><span class="p">)</span>
</pre>
            </div>
           </div>
           <p>
            Since we see
            <code class="docutils literal notranslate">
             <span class="pre">
              aten::elu
             </span>
            </code>
            in the graph, we know this is an ATen operator.
           </p>
           <p>
            We check the
            <a class="reference external" href="https://github.com/onnx/onnx/blob/master/docs/Operators.md">
             ONNX operator list
            </a>
            ,
and confirm that
            <code class="docutils literal notranslate">
             <span class="pre">
              Elu
             </span>
            </code>
            is standardized in ONNX.
           </p>
           <p>
            We find a signature for
            <code class="docutils literal notranslate">
             <span class="pre">
              elu
             </span>
            </code>
            in
            <code class="docutils literal notranslate">
             <span class="pre">
              torch/nn/functional.pyi
             </span>
            </code>
            :
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="k">def</span> <span class="nf">elu</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">...</span><span class="p">,</span> <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span> <span class="o">...</span>
</pre>
            </div>
           </div>
           <p>
            We add the following lines to
            <code class="docutils literal notranslate">
             <span class="pre">
              symbolic_opset9.py
             </span>
            </code>
            :
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="k">def</span> <span class="nf">elu</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">"Elu"</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">alpha_f</span><span class="o">=</span><span class="n">_scalar</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span>
</pre>
            </div>
           </div>
           <p>
            Now PyTorch is able to export models containing the
            <code class="docutils literal notranslate">
             <span class="pre">
              aten::elu
             </span>
            </code>
            operator!
           </p>
           <p>
            See the
            <code class="docutils literal notranslate">
             <span class="pre">
              symbolic_opset*.py
             </span>
            </code>
            files for more examples.
           </p>
          </div>
          <div class="section" id="torch-autograd-functions">
           <h3>
            <a class="toc-backref" href="#id17">
             torch.autograd.Functions
            </a>
            <a class="headerlink" href="#torch-autograd-functions" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            If the operator is a sub-class of
            <a class="reference internal" href="autograd.html#torch.autograd.Function" title="torch.autograd.Function">
             <code class="xref py py-class docutils literal notranslate">
              <span class="pre">
               torch.autograd.Function
              </span>
             </code>
            </a>
            , there are two ways
to export it.
           </p>
           <div class="section" id="static-symbolic-method">
            <h4>
             <a class="toc-backref" href="#id18">
              Static Symbolic Method
             </a>
             <a class="headerlink" href="#static-symbolic-method" title="Permalink to this headline">
              ¶
             </a>
            </h4>
            <p>
             You can add a static method named
             <code class="docutils literal notranslate">
              <span class="pre">
               symbolic
              </span>
             </code>
             to your function class. It should return
ONNX operators that represent the function’s behavior in ONNX. For example:
            </p>
            <div class="highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="k">class</span> <span class="nc">MyRelu</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Function</span><span class="p">):</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">save_for_backward</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">input</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">symbolic</span><span class="p">(</span><span class="n">g</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">Value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">Value</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">"Clip"</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">"Constant"</span><span class="p">,</span> <span class="n">value_t</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)))</span>
</pre>
             </div>
            </div>
           </div>
           <div class="section" id="pythonop-symbolic">
            <h4>
             <a class="toc-backref" href="#id19">
              PythonOp Symbolic
             </a>
             <a class="headerlink" href="#pythonop-symbolic" title="Permalink to this headline">
              ¶
             </a>
            </h4>
            <p>
             Alternatively, you can register a custom symbolic function.
This gives the symbolic function access to more info through the
TorchScript
             <code class="docutils literal notranslate">
              <span class="pre">
               Node
              </span>
             </code>
             object for the original operation, which gets passed in as the second
argument (after the
             <code class="docutils literal notranslate">
              <span class="pre">
               Graph
              </span>
             </code>
             object).
            </p>
            <p>
             All autograd
             <code class="docutils literal notranslate">
              <span class="pre">
               Function
              </span>
             </code>
             s appear in the TorchScript graph as
             <code class="docutils literal notranslate">
              <span class="pre">
               prim::PythonOp
              </span>
             </code>
             nodes.
In order to differentiate between different
             <code class="docutils literal notranslate">
              <span class="pre">
               Function
              </span>
             </code>
             subclasses, the
symbolic function should use the
             <code class="docutils literal notranslate">
              <span class="pre">
               name
              </span>
             </code>
             kwarg which gets set to the name of the class.
            </p>
            <p>
             <a class="reference internal" href="#torch.onnx.register_custom_op_symbolic" title="torch.onnx.register_custom_op_symbolic">
              <code class="xref py py-func docutils literal notranslate">
               <span class="pre">
                register_custom_op_symbolic()
               </span>
              </code>
             </a>
             does not allow registration for ops in
the
             <code class="docutils literal notranslate">
              <span class="pre">
               prim
              </span>
             </code>
             namespace, so for this use case, there’s a back door: register the
symbolic for
             <code class="docutils literal notranslate">
              <span class="pre">
               "::prim_PythonOp"
              </span>
             </code>
             .
            </p>
            <p>
             Custom symbolic functions should add type and shape information by calling
             <code class="docutils literal notranslate">
              <span class="pre">
               setType(...)
              </span>
             </code>
             on Value objects before returning them (implemented in C++ by
             <code class="docutils literal notranslate">
              <span class="pre">
               torch::jit::Value::setType
              </span>
             </code>
             ). This is not required, but it can help the exporter’s
shape and type inference for down-stream nodes. For a non-trivial example of
             <code class="docutils literal notranslate">
              <span class="pre">
               setType
              </span>
             </code>
             , see
             <code class="docutils literal notranslate">
              <span class="pre">
               test_aten_embedding_2
              </span>
             </code>
             in
             <a class="reference external" href="https://github.com/pytorch/pytorch/blob/master/test/onnx/test_operators.py">
              test_operators.py
             </a>
             .
            </p>
            <p>
             The example below shows how you can access
             <code class="docutils literal notranslate">
              <span class="pre">
               requires_grad
              </span>
             </code>
             via the
             <code class="docutils literal notranslate">
              <span class="pre">
               Node
              </span>
             </code>
             object:
            </p>
            <div class="highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="k">class</span> <span class="nc">MyClip</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Function</span><span class="p">):</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="nb">min</span><span class="p">):</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">save_for_backward</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">input</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="nb">min</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MyRelu</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Function</span><span class="p">):</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">save_for_backward</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">input</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">symbolic_pythonop</span><span class="p">(</span><span class="n">g</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">_C</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"original node: "</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">out</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">outputs</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"original output </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">, requires grad: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">requiresGrad</span><span class="p">()))</span>
    <span class="kn">import</span> <span class="nn">torch.onnx.symbolic_helper</span> <span class="k">as</span> <span class="nn">sym_helper</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
        <span class="n">requires_grad</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">requiresGrad</span><span class="p">()</span> <span class="k">if</span> <span class="n">sym_helper</span><span class="o">.</span><span class="n">_is_value</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"arg </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">, requires grad: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">requires_grad</span><span class="p">))</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">"MyClip"</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">"Clip"</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">min_f</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">"MyRelu"</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">"Relu"</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Logs a warning and returns None</span>
        <span class="k">return</span> <span class="n">_unimplemented</span><span class="p">(</span><span class="s2">"prim::PythonOp"</span><span class="p">,</span> <span class="s2">"unknown node kind: "</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
    <span class="c1"># Copy type and shape from original node.</span>
    <span class="n">ret</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">type</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">ret</span>

<span class="kn">from</span> <span class="nn">torch.onnx</span> <span class="kn">import</span> <span class="n">register_custom_op_symbolic</span>
<span class="n">register_custom_op_symbolic</span><span class="p">(</span><span class="s2">"::prim_PythonOp"</span><span class="p">,</span> <span class="n">symbolic_pythonop</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="section" id="custom-operators">
           <h3>
            <a class="toc-backref" href="#id20">
             Custom operators
            </a>
            <a class="headerlink" href="#custom-operators" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            If a model uses a custom operator implemented in C++ as described in
            <a class="reference external" href="https://pytorch.org/tutorials/advanced/torch_script_custom_ops.html">
             Extending TorchScript with Custom C++ Operators
            </a>
            ,
you can export it by following this example:
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="kn">from</span> <span class="nn">torch.onnx</span> <span class="kn">import</span> <span class="n">register_custom_op_symbolic</span>
<span class="kn">from</span> <span class="nn">torch.onnx.symbolic_helper</span> <span class="kn">import</span> <span class="n">parse_args</span>

<span class="c1"># Define custom symbolic function</span>
<span class="nd">@parse_args</span><span class="p">(</span><span class="s2">"v"</span><span class="p">,</span> <span class="s2">"v"</span><span class="p">,</span> <span class="s2">"f"</span><span class="p">,</span> <span class="s2">"i"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">symbolic_foo_forward</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">,</span> <span class="n">attr1</span><span class="p">,</span> <span class="n">attr2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">op</span><span class="p">(</span><span class="s2">"custom_domain::Foo"</span><span class="p">,</span> <span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">,</span> <span class="n">attr1_f</span><span class="o">=</span><span class="n">attr1</span><span class="p">,</span> <span class="n">attr2_i</span><span class="o">=</span><span class="n">attr2</span><span class="p">)</span>

<span class="c1"># Register custom symbolic function</span>
<span class="n">register_custom_op_symbolic</span><span class="p">(</span><span class="s2">"custom_ops::foo_forward"</span><span class="p">,</span> <span class="n">symbolic_foo_forward</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">FooModel</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr1</span><span class="p">,</span> <span class="n">attr2</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FooModule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr1</span> <span class="o">=</span> <span class="n">attr1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr2</span> <span class="o">=</span> <span class="n">attr2</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">):</span>
        <span class="c1"># Calling custom op</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">custom_ops</span><span class="o">.</span><span class="n">foo_forward</span><span class="p">(</span><span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr2</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">FooModel</span><span class="p">(</span><span class="n">attr1</span><span class="p">,</span> <span class="n">attr2</span><span class="p">)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
  <span class="n">model</span><span class="p">,</span>
  <span class="p">(</span><span class="n">example_input1</span><span class="p">,</span> <span class="n">example_input1</span><span class="p">),</span>
  <span class="s2">"model.onnx"</span><span class="p">,</span>
  <span class="c1"># only needed if you want to specify an opset version &gt; 1.</span>
  <span class="n">custom_opsets</span><span class="o">=</span><span class="p">{</span><span class="s2">"custom_domain"</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
</pre>
            </div>
           </div>
           <p>
            You can export it as one or a combination of standard ONNX ops, or as a custom operator.
The example above exports it as a custom operator in the “custom_domain” opset.
When exporting a custom operator, you can specify the custom domain version using the
            <code class="docutils literal notranslate">
             <span class="pre">
              custom_opsets
             </span>
            </code>
            dictionary at export. If not specified, the custom opset version defaults to 1.
The runtime that conumes the model needs to support the custom op. See
            <a class="reference external" href="https://caffe2.ai/docs/custom-operators.html">
             Caffe2 custom ops
            </a>
            ,
            <a class="reference external" href="https://github.com/microsoft/onnxruntime/blob/master/docs/AddingCustomOp.md">
             ONNX Runtime custom ops
            </a>
            ,
or your runtime of choice’s documentation.
           </p>
          </div>
         </div>
         <div class="section" id="frequently-asked-questions">
          <h2>
           <a class="toc-backref" href="#id21">
            Frequently Asked Questions
           </a>
           <a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           Q: I have exported my LSTM model, but its input size seems to be fixed?
          </p>
          <blockquote>
           <div>
            <p>
             The tracer records the shapes of the example inputs. If the model should accept
inputs of dynamic shapes, set
             <code class="docutils literal notranslate">
              <span class="pre">
               dynamic_axes
              </span>
             </code>
             when calling
             <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export">
              <code class="xref py py-func docutils literal notranslate">
               <span class="pre">
                torch.onnx.export()
               </span>
              </code>
             </a>
             .
            </p>
           </div>
          </blockquote>
          <p>
           Q: How to export models containing loops?
          </p>
          <blockquote>
           <div>
            <p>
             See
             <a class="reference internal" href="#id2">
              Tracing vs Scripting
             </a>
             .
            </p>
           </div>
          </blockquote>
          <p>
           Q: How to export models with primitive type inputs (e.g. int, float)?
          </p>
          <blockquote>
           <div>
            <p>
             Support for primitive numeric type inputs was added in PyTorch 1.9.
However, the exporter does not support models with str inputs.
            </p>
           </div>
          </blockquote>
          <p>
           Q: Does ONNX support implicit scalar datatype casting?
          </p>
          <blockquote>
           <div>
            <p>
             No, but the exporter will try to handle that part. Scalars are exported as constant tensors.
The exporter will try to figure out the right datatype for scalars. However when it is unable
to do so, you will need to manually specify the datatype. This often happens with
scripted models, where the datatypes are not recorded. For example:
            </p>
            <div class="highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="k">class</span> <span class="nc">ImplicitCastType</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">ScriptModule</span><span class="p">):</span>
    <span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script_method</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># Exporter knows x is float32, will export "2" as float32 as well.</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="c1"># Currently the exporter doesn't know the datatype of y, so</span>
        <span class="c1"># "3" is exported as int64, which is wrong!</span>
        <span class="k">return</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">3</span>
        <span class="c1"># To fix, replace the line above with:</span>
        <span class="c1"># return y + torch.tensor([3], dtype=torch.float32)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">ImplicitCastType</span><span class="p">(),</span> <span class="n">x</span><span class="p">,</span> <span class="s2">"implicit_cast.onnx"</span><span class="p">,</span>
                  <span class="n">example_outputs</span><span class="o">=</span><span class="n">ImplicitCastType</span><span class="p">()(</span><span class="n">x</span><span class="p">))</span>
</pre>
             </div>
            </div>
            <p>
             We are trying to improve the datatype propagation in the exporter such that implicit casting
is supported in more cases.
            </p>
           </div>
          </blockquote>
          <p>
           Q: Are lists of Tensors exportable to ONNX?
          </p>
          <blockquote>
           <div>
            <p>
             Yes, for
             <code class="docutils literal notranslate">
              <span class="pre">
               opset_version
              </span>
             </code>
             &gt;= 11, since ONNX introduced the Sequence type in opset 11.
            </p>
           </div>
          </blockquote>
         </div>
         <div class="section" id="functions">
          <h2>
           <a class="toc-backref" href="#id22">
            Functions
           </a>
           <a class="headerlink" href="#functions" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <dl class="py function">
           <dt id="torch.onnx.export">
            <code class="sig-prename descclassname">
             <span class="pre">
              torch.onnx.
             </span>
            </code>
            <code class="sig-name descname">
             <span class="pre">
              export
             </span>
            </code>
            <span class="sig-paren">
             (
            </span>
            <em class="sig-param">
             <span class="pre">
              model
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="pre">
              args
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="pre">
              f
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="pre">
              export_params=True
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="pre">
              verbose=False
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="pre">
              training=&lt;TrainingMode.EVAL:
             </span>
             <span class="pre">
              0&gt;
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="pre">
              input_names=None
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="pre">
              output_names=None
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="pre">
              operator_export_type=None
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="pre">
              opset_version=None
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="pre">
              _retain_param_name=None
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="pre">
              do_constant_folding=True
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="pre">
              example_outputs=None
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="pre">
              strip_doc_string=None
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="pre">
              dynamic_axes=None
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="pre">
              keep_initializers_as_inputs=None
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="pre">
              custom_opsets=None
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="pre">
              enable_onnx_checker=None
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="pre">
              use_external_data_format=None
             </span>
            </em>
            <span class="sig-paren">
             )
            </span>
            <a class="reference internal" href="_modules/torch/onnx.html#export">
             <span class="viewcode-link">
              <span class="pre">
               [source]
              </span>
             </span>
            </a>
            <a class="headerlink" href="#torch.onnx.export" title="Permalink to this definition">
             ¶
            </a>
           </dt>
           <dd>
            <p>
             Exports a model into ONNX format. If
             <code class="docutils literal notranslate">
              <span class="pre">
               model
              </span>
             </code>
             is not a
             <a class="reference internal" href="generated/torch.jit.ScriptModule.html#torch.jit.ScriptModule" title="torch.jit.ScriptModule">
              <code class="xref py py-class docutils literal notranslate">
               <span class="pre">
                torch.jit.ScriptModule
               </span>
              </code>
             </a>
             nor a
             <a class="reference internal" href="generated/torch.jit.ScriptFunction.html#torch.jit.ScriptFunction" title="torch.jit.ScriptFunction">
              <code class="xref py py-class docutils literal notranslate">
               <span class="pre">
                torch.jit.ScriptFunction
               </span>
              </code>
             </a>
             , this runs
             <code class="docutils literal notranslate">
              <span class="pre">
               model
              </span>
             </code>
             once in order to convert it to a TorchScript graph to be exported
(the equivalent of
             <a class="reference internal" href="generated/torch.jit.trace.html#torch.jit.trace" title="torch.jit.trace">
              <code class="xref py py-func docutils literal notranslate">
               <span class="pre">
                torch.jit.trace()
               </span>
              </code>
             </a>
             ). Thus this has the same limited support
for dynamic control flow as
             <a class="reference internal" href="generated/torch.jit.trace.html#torch.jit.trace" title="torch.jit.trace">
              <code class="xref py py-func docutils literal notranslate">
               <span class="pre">
                torch.jit.trace()
               </span>
              </code>
             </a>
             .
            </p>
            <dl class="field-list simple">
             <dt class="field-odd">
              Parameters
             </dt>
             <dd class="field-odd">
              <ul class="simple">
               <li>
                <p>
                 <strong>
                  model
                 </strong>
                 (
                 <a class="reference internal" href="generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module">
                  <em>
                   torch.nn.Module
                  </em>
                 </a>
                 <em>
                  ,
                 </em>
                 <a class="reference internal" href="generated/torch.jit.ScriptModule.html#torch.jit.ScriptModule" title="torch.jit.ScriptModule">
                  <em>
                   torch.jit.ScriptModule
                  </em>
                 </a>
                 <em>
                  or
                 </em>
                 <a class="reference internal" href="generated/torch.jit.ScriptFunction.html#torch.jit.ScriptFunction" title="torch.jit.ScriptFunction">
                  <em>
                   torch.jit.ScriptFunction
                  </em>
                 </a>
                 ) – the model to be exported.
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  args
                 </strong>
                 (
                 <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.10)">
                  <em>
                   tuple
                  </em>
                 </a>
                 <em>
                  or
                 </em>
                 <a class="reference internal" href="tensors.html#torch.Tensor" title="torch.Tensor">
                  <em>
                   torch.Tensor
                  </em>
                 </a>
                 ) –
                 <p>
                  args can be structured either as:
                 </p>
                 <ol class="arabic">
                  <li>
                   <p>
                    ONLY A TUPLE OF ARGUMENTS:
                   </p>
                   <div class="highlight-default notranslate">
                    <div class="highlight">
                     <pre><span></span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
</pre>
                    </div>
                   </div>
                  </li>
                 </ol>
                 <p>
                  The tuple should contain model inputs such that
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    model(*args)
                   </span>
                  </code>
                  is a valid
invocation of the model. Any non-Tensor arguments will be hard-coded into the
exported model; any Tensor arguments will become inputs of the exported model,
in the order they occur in the tuple.
                 </p>
                 <ol class="arabic" start="2">
                  <li>
                   <p>
                    A TENSOR:
                   </p>
                   <div class="highlight-default notranslate">
                    <div class="highlight">
                     <pre><span></span><span class="n">args</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
</pre>
                    </div>
                   </div>
                  </li>
                 </ol>
                 <p>
                  This is equivalent to a 1-ary tuple of that Tensor.
                 </p>
                 <ol class="arabic" start="3">
                  <li>
                   <p>
                    A TUPLE OF ARGUMENTS ENDING WITH A DICTIONARY OF NAMED ARGUMENTS:
                   </p>
                   <div class="highlight-default notranslate">
                    <div class="highlight">
                     <pre><span></span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span>
        <span class="p">{</span><span class="s1">'y'</span><span class="p">:</span> <span class="n">input_y</span><span class="p">,</span>
         <span class="s1">'z'</span><span class="p">:</span> <span class="n">input_z</span><span class="p">})</span>
</pre>
                    </div>
                   </div>
                  </li>
                 </ol>
                 <p>
                  All but the last element of the tuple will be passed as non-keyword arguments,
and named arguments will be set from the last element. If a named argument is
not present in the dictionary, it is assigned the default value, or None if a
default value is not provided.
                 </p>
                 <div class="admonition note">
                  <p class="admonition-title">
                   Note
                  </p>
                  <p>
                   If a dictionary is the last element of the args tuple, it will be
interpreted as containing named arguments. In order to pass a dict as the
last non-keyword arg, provide an empty dict as the last element of the args
tuple. For example, instead of:
                  </p>
                  <div class="highlight-default notranslate">
                   <div class="highlight">
                    <pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="p">(</span><span class="n">x</span><span class="p">,</span>
     <span class="c1"># WRONG: will be interpreted as named arguments</span>
     <span class="p">{</span><span class="n">y</span><span class="p">:</span> <span class="n">z</span><span class="p">}),</span>
    <span class="s2">"test.onnx.pb"</span><span class="p">)</span>
</pre>
                   </div>
                  </div>
                  <p>
                   Write:
                  </p>
                  <div class="highlight-default notranslate">
                   <div class="highlight">
                    <pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="p">(</span><span class="n">x</span><span class="p">,</span>
     <span class="p">{</span><span class="n">y</span><span class="p">:</span> <span class="n">z</span><span class="p">},</span>
     <span class="p">{}),</span>
    <span class="s2">"test.onnx.pb"</span><span class="p">)</span>
</pre>
                   </div>
                  </div>
                 </div>
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  f
                 </strong>
                 – a file-like object (such that
                 <code class="docutils literal notranslate">
                  <span class="pre">
                   f.fileno()
                  </span>
                 </code>
                 returns a file descriptor)
or a string containing a file name.  A binary protocol buffer will be written
to this file.
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  export_params
                 </strong>
                 (
                 <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)">
                  <em>
                   bool
                  </em>
                 </a>
                 <em>
                  ,
                 </em>
                 <em>
                  default True
                 </em>
                 ) – if True, all parameters will
be exported. Set this to False if you want to export an untrained model.
In this case, the exported model will first take all of its parameters
as arguments, with the ordering as specified by
                 <code class="docutils literal notranslate">
                  <span class="pre">
                   model.state_dict().values()
                  </span>
                 </code>
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  verbose
                 </strong>
                 (
                 <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)">
                  <em>
                   bool
                  </em>
                 </a>
                 <em>
                  ,
                 </em>
                 <em>
                  default False
                 </em>
                 ) – if True, prints a description of the
model being exported to stdout. In addition, the final ONNX graph will include the
field
                 <code class="docutils literal notranslate">
                  <span class="pre">
                   doc_string`
                  </span>
                 </code>
                 from the exported model which mentions the source code locations
for
                 <code class="docutils literal notranslate">
                  <span class="pre">
                   model
                  </span>
                 </code>
                 .
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  training
                 </strong>
                 (
                 <em>
                  enum
                 </em>
                 <em>
                  ,
                 </em>
                 <em>
                  default TrainingMode.EVAL
                 </em>
                 ) –
                 <ul>
                  <li>
                   <p>
                    <code class="docutils literal notranslate">
                     <span class="pre">
                      TrainingMode.EVAL
                     </span>
                    </code>
                    : export the model in inference mode.
                   </p>
                  </li>
                  <li>
                   <p>
                    <code class="docutils literal notranslate">
                     <span class="pre">
                      TrainingMode.PRESERVE
                     </span>
                    </code>
                    : export the model in inference mode if model.training is
False and in training mode if model.training is True.
                   </p>
                  </li>
                  <li>
                   <p>
                    <code class="docutils literal notranslate">
                     <span class="pre">
                      TrainingMode.TRAINING
                     </span>
                    </code>
                    : export the model in training mode. Disables optimizations
which might interfere with training.
                   </p>
                  </li>
                 </ul>
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  input_names
                 </strong>
                 (
                 <em>
                  list of str
                 </em>
                 <em>
                  ,
                 </em>
                 <em>
                  default empty list
                 </em>
                 ) – names to assign to the
input nodes of the graph, in order.
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  output_names
                 </strong>
                 (
                 <em>
                  list of str
                 </em>
                 <em>
                  ,
                 </em>
                 <em>
                  default empty list
                 </em>
                 ) – names to assign to the
output nodes of the graph, in order.
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  operator_export_type
                 </strong>
                 (
                 <em>
                  enum
                 </em>
                 <em>
                  ,
                 </em>
                 <em>
                  default None
                 </em>
                 ) –
                 <p>
                  None usually means
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    OperatorExportTypes.ONNX
                   </span>
                  </code>
                  .
However if PyTorch was built with
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    -DPYTORCH_ONNX_CAFFE2_BUNDLE
                   </span>
                  </code>
                  , None means
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    OperatorExportTypes.ONNX_ATEN_FALLBACK
                   </span>
                  </code>
                  .
                 </p>
                 <ul>
                  <li>
                   <p>
                    <code class="docutils literal notranslate">
                     <span class="pre">
                      OperatorExportTypes.ONNX
                     </span>
                    </code>
                    : Export all ops as regular ONNX ops
(in the default opset domain).
                   </p>
                  </li>
                  <li>
                   <p>
                    <code class="docutils literal notranslate">
                     <span class="pre">
                      OperatorExportTypes.ONNX_FALLTHROUGH
                     </span>
                    </code>
                    : Try to convert all ops
to standard ONNX ops in the default opset domain. If unable to do so
(e.g. because support has not been added to convert a particular torch op to ONNX),
fall back to exporting the op into a custom opset domain without conversion. Applies
to
                    <a class="reference external" href="https://pytorch.org/tutorials/advanced/torch_script_custom_ops.html">
                     custom ops
                    </a>
                    as well as ATen ops. For the exported model to be usable, the runtime must support
these non-standard ops.
                   </p>
                  </li>
                  <li>
                   <p>
                    <code class="docutils literal notranslate">
                     <span class="pre">
                      OperatorExportTypes.ONNX_ATEN
                     </span>
                    </code>
                    : All ATen ops (in the TorchScript namespace “aten”)
are exported as ATen ops (in opset domain “org.pytorch.aten”).
                    <a class="reference external" href="https://pytorch.org/cppdocs/#aten">
                     ATen
                    </a>
                    is PyTorch’s built-in tensor library, so
this instructs the runtime to use PyTorch’s implementation of these ops.
                   </p>
                   <div class="admonition warning">
                    <p class="admonition-title">
                     Warning
                    </p>
                    <p>
                     Models exported this way are probably runnable only by Caffe2.
                    </p>
                   </div>
                   <p>
                    This may be useful if the numeric differences in implementations of operators are
causing large differences in behavior between PyTorch and Caffe2 (which is more
common on untrained models).
                   </p>
                  </li>
                  <li>
                   <p>
                    <code class="docutils literal notranslate">
                     <span class="pre">
                      OperatorExportTypes.ONNX_ATEN_FALLBACK
                     </span>
                    </code>
                    : Try to export each ATen op
(in the TorchScript namespace “aten”) as a regular ONNX op. If we are unable to do so
(e.g. because support has not been added to convert a particular torch op to ONNX),
fall back to exporting an ATen op. See documentation on OperatorExportTypes.ONNX_ATEN for
context.
For example:
                   </p>
                   <div class="highlight-default notranslate">
                    <div class="highlight">
                     <pre><span></span><span class="n">graph</span><span class="p">(</span><span class="o">%</span><span class="mi">0</span> <span class="p">:</span> <span class="n">Float</span><span class="p">):</span>
  <span class="o">%</span><span class="mi">3</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">prim</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">]()</span>
  <span class="c1"># conversion unsupported</span>
  <span class="o">%</span><span class="mi">4</span> <span class="p">:</span> <span class="n">Float</span> <span class="o">=</span> <span class="n">aten</span><span class="p">::</span><span class="n">triu</span><span class="p">(</span><span class="o">%</span><span class="mi">0</span><span class="p">,</span> <span class="o">%</span><span class="mi">3</span><span class="p">)</span>
  <span class="c1"># conversion supported</span>
  <span class="o">%</span><span class="mi">5</span> <span class="p">:</span> <span class="n">Float</span> <span class="o">=</span> <span class="n">aten</span><span class="p">::</span><span class="n">mul</span><span class="p">(</span><span class="o">%</span><span class="mi">4</span><span class="p">,</span> <span class="o">%</span><span class="mi">0</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">%</span><span class="mi">5</span><span class="p">)</span>
</pre>
                    </div>
                   </div>
                   <p>
                    Assuming
                    <code class="docutils literal notranslate">
                     <span class="pre">
                      aten::triu
                     </span>
                    </code>
                    is not supported in ONNX, this will be exported as:
                   </p>
                   <div class="highlight-default notranslate">
                    <div class="highlight">
                     <pre><span></span><span class="n">graph</span><span class="p">(</span><span class="o">%</span><span class="mi">0</span> <span class="p">:</span> <span class="n">Float</span><span class="p">):</span>
  <span class="o">%</span><span class="mi">1</span> <span class="p">:</span> <span class="n">Long</span><span class="p">()</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Constant</span><span class="p">[</span><span class="n">value</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">}]()</span>
  <span class="c1"># not converted</span>
  <span class="o">%</span><span class="mi">2</span> <span class="p">:</span> <span class="n">Float</span> <span class="o">=</span> <span class="n">aten</span><span class="p">::</span><span class="n">ATen</span><span class="p">[</span><span class="n">operator</span><span class="o">=</span><span class="s2">"triu"</span><span class="p">](</span><span class="o">%</span><span class="mi">0</span><span class="p">,</span> <span class="o">%</span><span class="mi">1</span><span class="p">)</span>
  <span class="c1"># converted</span>
  <span class="o">%</span><span class="mi">3</span> <span class="p">:</span> <span class="n">Float</span> <span class="o">=</span> <span class="n">onnx</span><span class="p">::</span><span class="n">Mul</span><span class="p">(</span><span class="o">%</span><span class="mi">2</span><span class="p">,</span> <span class="o">%</span><span class="mi">0</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">%</span><span class="mi">3</span><span class="p">)</span>
</pre>
                    </div>
                   </div>
                   <p>
                    If an op is in the TorchScript namespace “quantized”, it will be exported
in the ONNX opset domain “caffe2”. These ops are produced by
the modules described in
                    <a class="reference external" href="https://pytorch.org/docs/stable/quantization.html">
                     Quantization
                    </a>
                    .
                   </p>
                   <div class="admonition warning">
                    <p class="admonition-title">
                     Warning
                    </p>
                    <p>
                     Models exported this way are probably runnable only by Caffe2.
                    </p>
                   </div>
                  </li>
                 </ul>
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  opset_version
                 </strong>
                 (
                 <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">
                  <em>
                   int
                  </em>
                 </a>
                 <em>
                  ,
                 </em>
                 <em>
                  default 9
                 </em>
                 ) – Must be
                 <code class="docutils literal notranslate">
                  <span class="pre">
                   ==
                  </span>
                  <span class="pre">
                   _onnx_main_opset
                  </span>
                  <span class="pre">
                   or
                  </span>
                  <span class="pre">
                   in
                  </span>
                  <span class="pre">
                   _onnx_stable_opsets
                  </span>
                 </code>
                 ,
defined in torch/onnx/symbolic_helper.py.
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  _retain_param_name
                 </strong>
                 (
                 <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)">
                  <em>
                   bool
                  </em>
                 </a>
                 <em>
                  ,
                 </em>
                 <em>
                  default True
                 </em>
                 ) – [Deprecated and ignored. Will be removed in next PyTorch
release]
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  do_constant_folding
                 </strong>
                 (
                 <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)">
                  <em>
                   bool
                  </em>
                 </a>
                 <em>
                  ,
                 </em>
                 <em>
                  default False
                 </em>
                 ) – Apply the constant-folding optimization.
Constant-folding will replace some of the ops that have all constant inputs
with pre-computed constant nodes.
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  example_outputs
                 </strong>
                 (
                 <em>
                  T
                 </em>
                 <em>
                  or
                 </em>
                 <em>
                  a tuple of T
                 </em>
                 <em>
                  ,
                 </em>
                 <em>
                  where T is Tensor
                 </em>
                 <em>
                  or
                 </em>
                 <em>
                  convertible to Tensor
                 </em>
                 <em>
                  ,
                 </em>
                 <em>
                  default None
                 </em>
                 ) – [Deprecated and ignored. Will be removed in next PyTorch release],
Must be provided when exporting a ScriptModule or ScriptFunction, ignored otherwise.
Used to determine the type and shape of the outputs without tracing the execution of
the model. A single object is treated as equivalent to a tuple of one element.
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  strip_doc_string
                 </strong>
                 (
                 <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)">
                  <em>
                   bool
                  </em>
                 </a>
                 <em>
                  ,
                 </em>
                 <em>
                  default True
                 </em>
                 ) – [Deprecated and ignored. Will be removed in next PyTorch release]
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  dynamic_axes
                 </strong>
                 (
                 <em>
                  dict&lt;string
                 </em>
                 <em>
                  ,
                 </em>
                 <em>
                  dict&lt;python:int
                 </em>
                 <em>
                  ,
                 </em>
                 <em>
                  string&gt;&gt;
                 </em>
                 <em>
                  or
                 </em>
                 <em>
                  dict&lt;string
                 </em>
                 <em>
                  ,
                 </em>
                 <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.10)">
                  <em>
                   list
                  </em>
                 </a>
                 <em>
                  (
                 </em>
                 <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">
                  <em>
                   int
                  </em>
                 </a>
                 <em>
                  )
                 </em>
                 <em>
                  &gt;
                 </em>
                 <em>
                  ,
                 </em>
                 <em>
                  default empty dict
                 </em>
                 ) –
                 <p>
                  By default the exported model will have the shapes of all input and output tensors
set to exactly match those given in
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    args
                   </span>
                  </code>
                  (and
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    example_outputs
                   </span>
                  </code>
                  when that arg is
required). To specify axes of tensors as dynamic (i.e. known only at run-time), set
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    dynamic_axes
                   </span>
                  </code>
                  to a dict with schema:
                 </p>
                 <ul>
                  <li>
                   <p>
                    KEY (str): an input or output name. Each name must also be provided in
                    <code class="docutils literal notranslate">
                     <span class="pre">
                      input_names
                     </span>
                    </code>
                    or
                    <code class="docutils literal notranslate">
                     <span class="pre">
                      output_names
                     </span>
                    </code>
                    .
                   </p>
                  </li>
                  <li>
                   <p>
                    VALUE (dict or list): If a dict, keys are axis indices and values are axis names. If a
list, each element is an axis index.
                   </p>
                  </li>
                 </ul>
                 <p>
                  For example:
                 </p>
                 <div class="highlight-default notranslate">
                  <div class="highlight">
                   <pre><span></span><span class="k">class</span> <span class="nc">SumModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">SumModule</span><span class="p">(),</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),),</span> <span class="s2">"onnx.pb"</span><span class="p">,</span>
                  <span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">"sum"</span><span class="p">])</span>
</pre>
                  </div>
                 </div>
                 <p>
                  Produces:
                 </p>
                 <div class="highlight-default notranslate">
                  <div class="highlight">
                   <pre><span></span><span class="nb">input</span> <span class="p">{</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">"x"</span>
  <span class="o">...</span>
      <span class="n">shape</span> <span class="p">{</span>
        <span class="n">dim</span> <span class="p">{</span>
          <span class="n">dim_value</span><span class="p">:</span> <span class="mi">2</span>  <span class="c1"># axis 0</span>
        <span class="p">}</span>
        <span class="n">dim</span> <span class="p">{</span>
          <span class="n">dim_value</span><span class="p">:</span> <span class="mi">2</span>  <span class="c1"># axis 1</span>
<span class="o">...</span>
<span class="n">output</span> <span class="p">{</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">"sum"</span>
  <span class="o">...</span>
      <span class="n">shape</span> <span class="p">{</span>
        <span class="n">dim</span> <span class="p">{</span>
          <span class="n">dim_value</span><span class="p">:</span> <span class="mi">2</span>  <span class="c1"># axis 0</span>
<span class="o">...</span>
</pre>
                  </div>
                 </div>
                 <p>
                  While:
                 </p>
                 <div class="highlight-default notranslate">
                  <div class="highlight">
                   <pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">SumModule</span><span class="p">(),</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),),</span> <span class="s2">"onnx.pb"</span><span class="p">,</span>
                  <span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">"sum"</span><span class="p">],</span>
                  <span class="n">dynamic_axes</span><span class="o">=</span><span class="p">{</span>
                      <span class="c1"># dict value: manually named axes</span>
                      <span class="s2">"x"</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">"my_custom_axis_name"</span><span class="p">},</span>
                      <span class="c1"># list value: automatic names</span>
                      <span class="s2">"sum"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                  <span class="p">})</span>
</pre>
                  </div>
                 </div>
                 <p>
                  Produces:
                 </p>
                 <div class="highlight-default notranslate">
                  <div class="highlight">
                   <pre><span></span><span class="nb">input</span> <span class="p">{</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">"x"</span>
  <span class="o">...</span>
      <span class="n">shape</span> <span class="p">{</span>
        <span class="n">dim</span> <span class="p">{</span>
          <span class="n">dim_param</span><span class="p">:</span> <span class="s2">"my_custom_axis_name"</span>  <span class="c1"># axis 0</span>
        <span class="p">}</span>
        <span class="n">dim</span> <span class="p">{</span>
          <span class="n">dim_value</span><span class="p">:</span> <span class="mi">2</span>  <span class="c1"># axis 1</span>
<span class="o">...</span>
<span class="n">output</span> <span class="p">{</span>
  <span class="n">name</span><span class="p">:</span> <span class="s2">"sum"</span>
  <span class="o">...</span>
      <span class="n">shape</span> <span class="p">{</span>
        <span class="n">dim</span> <span class="p">{</span>
          <span class="n">dim_param</span><span class="p">:</span> <span class="s2">"sum_dynamic_axes_1"</span>  <span class="c1"># axis 0</span>
<span class="o">...</span>
</pre>
                  </div>
                 </div>
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  keep_initializers_as_inputs
                 </strong>
                 (
                 <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)">
                  <em>
                   bool
                  </em>
                 </a>
                 <em>
                  ,
                 </em>
                 <em>
                  default None
                 </em>
                 ) –
                 <p>
                  If True, all the
initializers (typically corresponding to parameters) in the
exported graph will also be added as inputs to the graph. If False,
then initializers are not added as inputs to the graph, and only
the non-parameter inputs are added as inputs.
This may allow for better optimizations (e.g. constant folding) by
backends/runtimes.
                 </p>
                 <p>
                  If
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    opset_version
                   </span>
                  </code>
                  &lt; 9, initializers MUST be part of graph
inputs and this argument will be ignored and the behavior will be
equivalent to setting this argument to True.
                 </p>
                 <p>
                  If None, then the behavior is chosen automatically as follows:
                 </p>
                 <ul>
                  <li>
                   <p>
                    If
                    <code class="docutils literal notranslate">
                     <span class="pre">
                      operator_export_type=OperatorExportTypes.ONNX
                     </span>
                    </code>
                    , the behavior is equivalent
to setting this argument to False.
                   </p>
                  </li>
                  <li>
                   <p>
                    Else, the behavior is equivalent to setting this argument to True.
                   </p>
                  </li>
                 </ul>
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  custom_opsets
                 </strong>
                 (
                 <em>
                  dict&lt;str
                 </em>
                 <em>
                  ,
                 </em>
                 <em>
                  int&gt;
                 </em>
                 <em>
                  ,
                 </em>
                 <em>
                  default empty dict
                 </em>
                 ) –
                 <p>
                  A dictionary to indicate
                 </p>
                 <p>
                  A dict with schema:
                 </p>
                 <ul>
                  <li>
                   <p>
                    KEY (str): opset domain name
                   </p>
                  </li>
                  <li>
                   <p>
                    VALUE (int): opset version
                   </p>
                  </li>
                 </ul>
                 <p>
                  If a custom opset is referenced by
                  <code class="docutils literal notranslate">
                   <span class="pre">
                    model
                   </span>
                  </code>
                  but not mentioned in this dictionary,
the opset version is set to 1.
                 </p>
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  enable_onnx_checker
                 </strong>
                 (
                 <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)">
                  <em>
                   bool
                  </em>
                 </a>
                 <em>
                  ,
                 </em>
                 <em>
                  default True
                 </em>
                 ) – Deprecated and ignored. Will be removed in next
Pytorch release.
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  use_external_data_format
                 </strong>
                 (
                 <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)">
                  <em>
                   bool
                  </em>
                 </a>
                 <em>
                  ,
                 </em>
                 <em>
                  default False
                 </em>
                 ) – [Deprecated and ignored. Will be removed in
next Pytorch release.]
If True, then some of the model parameters are stored in external data files and not in
the ONNX model file itself. Models larger than 2GB cannot be exported in one file because
of size limits imposed by Protocol Buffers.
For details see
                 <a class="reference external" href="https://github.com/onnx/onnx/blob/32c7cb66/onnx/onnx.proto#L562">
                  onnx.proto
                 </a>
                 .
If True,  argument
                 <code class="docutils literal notranslate">
                  <span class="pre">
                   f
                  </span>
                 </code>
                 must be a string specifying the location of the model.
The external data files will be stored in the same directory as
                 <code class="docutils literal notranslate">
                  <span class="pre">
                   f
                  </span>
                 </code>
                 .
This argument is ignored unless
                 <code class="docutils literal notranslate">
                  <span class="pre">
                   operator_export_type=OperatorExportTypes.ONNX
                  </span>
                 </code>
                 .
                </p>
               </li>
              </ul>
             </dd>
             <dt class="field-even">
              Raises
             </dt>
             <dd class="field-even">
              <p>
               <strong>
                ONNXCheckerError
               </strong>
               – If the ONNX checker detects an invalid ONNX graph. Will still export the
    model to the file
               <code class="docutils literal notranslate">
                <span class="pre">
                 f
                </span>
               </code>
               even if this is raised.
              </p>
             </dd>
            </dl>
           </dd>
          </dl>
          <dl class="py function">
           <dt id="torch.onnx.export_to_pretty_string">
            <code class="sig-prename descclassname">
             <span class="pre">
              torch.onnx.
             </span>
            </code>
            <code class="sig-name descname">
             <span class="pre">
              export_to_pretty_string
             </span>
            </code>
            <span class="sig-paren">
             (
            </span>
            <em class="sig-param">
             <span class="o">
              <span class="pre">
               *
              </span>
             </span>
             <span class="n">
              <span class="pre">
               args
              </span>
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="o">
              <span class="pre">
               **
              </span>
             </span>
             <span class="n">
              <span class="pre">
               kwargs
              </span>
             </span>
            </em>
            <span class="sig-paren">
             )
            </span>
            <a class="reference internal" href="_modules/torch/onnx.html#export_to_pretty_string">
             <span class="viewcode-link">
              <span class="pre">
               [source]
              </span>
             </span>
            </a>
            <a class="headerlink" href="#torch.onnx.export_to_pretty_string" title="Permalink to this definition">
             ¶
            </a>
           </dt>
           <dd>
            <p>
             Similar to
             <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export">
              <code class="xref py py-func docutils literal notranslate">
               <span class="pre">
                export()
               </span>
              </code>
             </a>
             , but returns a text representation of the ONNX
model. Only differences in args listed below. All other args are the same
as
             <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export">
              <code class="xref py py-func docutils literal notranslate">
               <span class="pre">
                export()
               </span>
              </code>
             </a>
             .
            </p>
            <dl class="field-list simple">
             <dt class="field-odd">
              Parameters
             </dt>
             <dd class="field-odd">
              <ul class="simple">
               <li>
                <p>
                 <strong>
                  f
                 </strong>
                 – Deprecated and ignored. Will be removed in the next release of
PyTorch.
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  add_node_names
                 </strong>
                 (
                 <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)">
                  <em>
                   bool
                  </em>
                 </a>
                 <em>
                  ,
                 </em>
                 <em>
                  default True
                 </em>
                 ) – Whether or not to set
NodeProto.name. This makes no difference unless
                 <code class="docutils literal notranslate">
                  <span class="pre">
                   google_printer=True
                  </span>
                 </code>
                 .
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  google_printer
                 </strong>
                 (
                 <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)">
                  <em>
                   bool
                  </em>
                 </a>
                 <em>
                  ,
                 </em>
                 <em>
                  default False
                 </em>
                 ) – If False, will return a custom,
compact representation of the model. If True will return the
protobuf’s
                 <cite>
                  Message::DebugString()
                 </cite>
                 , which is more verbose.
                </p>
               </li>
              </ul>
             </dd>
             <dt class="field-even">
              Returns
             </dt>
             <dd class="field-even">
              <p>
               A UTF-8 str containing a human-readable representation of the ONNX model.
              </p>
             </dd>
            </dl>
           </dd>
          </dl>
          <dl class="py function">
           <dt id="torch.onnx.register_custom_op_symbolic">
            <code class="sig-prename descclassname">
             <span class="pre">
              torch.onnx.
             </span>
            </code>
            <code class="sig-name descname">
             <span class="pre">
              register_custom_op_symbolic
             </span>
            </code>
            <span class="sig-paren">
             (
            </span>
            <em class="sig-param">
             <span class="n">
              <span class="pre">
               symbolic_name
              </span>
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="n">
              <span class="pre">
               symbolic_fn
              </span>
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="n">
              <span class="pre">
               opset_version
              </span>
             </span>
            </em>
            <span class="sig-paren">
             )
            </span>
            <a class="reference internal" href="_modules/torch/onnx.html#register_custom_op_symbolic">
             <span class="viewcode-link">
              <span class="pre">
               [source]
              </span>
             </span>
            </a>
            <a class="headerlink" href="#torch.onnx.register_custom_op_symbolic" title="Permalink to this definition">
             ¶
            </a>
           </dt>
           <dd>
            <p>
             Registers
             <code class="docutils literal notranslate">
              <span class="pre">
               symbolic_fn
              </span>
             </code>
             to handle
             <code class="docutils literal notranslate">
              <span class="pre">
               symbolic_name
              </span>
             </code>
             . See
“Custom Operators” in the module documentation for an example usage.
            </p>
            <dl class="field-list simple">
             <dt class="field-odd">
              Parameters
             </dt>
             <dd class="field-odd">
              <ul class="simple">
               <li>
                <p>
                 <strong>
                  symbolic_name
                 </strong>
                 (
                 <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)">
                  <em>
                   str
                  </em>
                 </a>
                 ) – The name of the custom operator in “&lt;domain&gt;::&lt;op&gt;”
format.
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  symbolic_fn
                 </strong>
                 (
                 <em>
                  Callable
                 </em>
                 ) – A function that takes in the ONNX graph and
the input arguments to the current operator, and returns new
operator nodes to add to the graph.
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  opset_version
                 </strong>
                 (
                 <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">
                  <em>
                   int
                  </em>
                 </a>
                 ) – The ONNX opset version in which to register.
                </p>
               </li>
              </ul>
             </dd>
            </dl>
           </dd>
          </dl>
          <dl class="py function">
           <dt id="torch.onnx.select_model_mode_for_export">
            <code class="sig-prename descclassname">
             <span class="pre">
              torch.onnx.
             </span>
            </code>
            <code class="sig-name descname">
             <span class="pre">
              select_model_mode_for_export
             </span>
            </code>
            <span class="sig-paren">
             (
            </span>
            <em class="sig-param">
             <span class="n">
              <span class="pre">
               model
              </span>
             </span>
            </em>
            ,
            <em class="sig-param">
             <span class="n">
              <span class="pre">
               mode
              </span>
             </span>
            </em>
            <span class="sig-paren">
             )
            </span>
            <a class="reference internal" href="_modules/torch/onnx.html#select_model_mode_for_export">
             <span class="viewcode-link">
              <span class="pre">
               [source]
              </span>
             </span>
            </a>
            <a class="headerlink" href="#torch.onnx.select_model_mode_for_export" title="Permalink to this definition">
             ¶
            </a>
           </dt>
           <dd>
            <p>
             A context manager to temporarily set the training mode of
             <code class="docutils literal notranslate">
              <span class="pre">
               model
              </span>
             </code>
             to
             <code class="docutils literal notranslate">
              <span class="pre">
               mode
              </span>
             </code>
             , resetting it when we exit the with-block.  A no-op if
mode is None.
            </p>
            <dl class="field-list simple">
             <dt class="field-odd">
              Parameters
             </dt>
             <dd class="field-odd">
              <ul class="simple">
               <li>
                <p>
                 <strong>
                  model
                 </strong>
                 – Same type and meaning as
                 <code class="docutils literal notranslate">
                  <span class="pre">
                   model
                  </span>
                 </code>
                 arg to
                 <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export">
                  <code class="xref py py-func docutils literal notranslate">
                   <span class="pre">
                    export()
                   </span>
                  </code>
                 </a>
                 .
                </p>
               </li>
               <li>
                <p>
                 <strong>
                  mode
                 </strong>
                 – Same type and meaning as
                 <code class="docutils literal notranslate">
                  <span class="pre">
                   training
                  </span>
                 </code>
                 arg to
                 <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export">
                  <code class="xref py py-func docutils literal notranslate">
                   <span class="pre">
                    export()
                   </span>
                  </code>
                 </a>
                 .
                </p>
               </li>
              </ul>
             </dd>
            </dl>
           </dd>
          </dl>
          <dl class="py function">
           <dt id="torch.onnx.is_in_onnx_export">
            <code class="sig-prename descclassname">
             <span class="pre">
              torch.onnx.
             </span>
            </code>
            <code class="sig-name descname">
             <span class="pre">
              is_in_onnx_export
             </span>
            </code>
            <span class="sig-paren">
             (
            </span>
            <span class="sig-paren">
             )
            </span>
            <a class="reference internal" href="_modules/torch/onnx.html#is_in_onnx_export">
             <span class="viewcode-link">
              <span class="pre">
               [source]
              </span>
             </span>
            </a>
            <a class="headerlink" href="#torch.onnx.is_in_onnx_export" title="Permalink to this definition">
             ¶
            </a>
           </dt>
           <dd>
            <p>
             Returns True iff
             <a class="reference internal" href="#torch.onnx.export" title="torch.onnx.export">
              <code class="xref py py-func docutils literal notranslate">
               <span class="pre">
                export()
               </span>
              </code>
             </a>
             is running in the current thread
            </p>
           </dd>
          </dl>
         </div>
        </div>
       </article>
      </div>
     </div>
    </div>
   </section>
  </div>
 </body>
</html>